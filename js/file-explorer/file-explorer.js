!function(){if(!window.hasOwnProperty("FileExplorer")){var e,t=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(function(e){return t[e]}))},r=function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,(function(e,r){return"undefined"!=typeof t[r]?t[r]:e}))},s=function(e,t,r){if(0==e)return"0 Bytes";if(1==e)return"1 Byte";var s,a;e=Math.abs(e),r&&"iec_formal"===r.toLowerCase()?(s=Math.pow(2,10),a=["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]):r&&"si"===r.toLowerCase()?(s=Math.pow(10,3),a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"]):(s=Math.pow(2,10),a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"]);var n=Math.floor(Math.log(e)/Math.log(s)),i=e/Math.pow(s,n);return(0==n||t&&i>=99.995?i.toFixed(0):i.toFixed(2))+" "+a[n]},a=function(e,t,r,s){var a=document.createElement(e);return t&&(a.className="string"==typeof t?t:t.join(" ")),r&&Object.assign(a,r),s&&Object.assign(a.style,s),a},n=function(e){if(!(this instanceof n))return new n(e);var t,r=null,s=this;s.settings=Object.assign({},{watchers:[],interval:50,stopsame:1,callback:null,intervalcallback:null},e);var a=function(){for(var e=0,r=0;r<s.settings.watchers.length;r++){var a=s.settings.watchers[r];a.val===a.elem[a.attr]?e++:a.val=a.elem[a.attr]}e<s.settings.watchers.length?(t=0,s.settings.intervalcallback&&s.settings.intervalcallback.call(s)):++t>=s.settings.stopsame&&(s.Stop(),s.settings.intervalcallback&&s.settings.intervalcallback.call(s),s.settings.callback&&s.settings.callback.call(s))};s.Start=function(){r||(t=0,r=setInterval(a,s.settings.interval))},s.Stop=function(){r&&(clearInterval(r),r=null)},s.Destroy=function(){s.Stop(),s=null}},i=function(){var e=document.createElement("iframe");e.src="#",document.body.appendChild(e);var t=e.contentWindow.document;t.open(),t.write("<!DOCTYPE html><html><head></head><body><span>a</span></body></html>"),t.close();var r=t.body.firstElementChild.offsetHeight;return document.body.removeChild(e),r}(),o=0;if(window.addEventListener("popstate",(function(t){if(!o)if(t.state&&t.state._fileexplorer){var r=t.state._fileexplorerprevscroll;window.history.back(),r&&(e=r)}else e&&setTimeout((function(){window.history.scrollRestoration=e,e=null}),20)}),!0),window.history.state&&window.history.state._fileexplorer){var l=window.history.state._fileexplorerprevscroll;window.history.back(),l&&(e=l)}var d,p=0,f={};window.addEventListener("dragenter",(function(e){if(!p){var t=I(e);if(!1!==t){d=a("div",["fe_fileexplorer_floating_drag_icon_wrap"]);var r=a("div",["fe_fileexplorer_floating_drag_icon_wrap_inner"]),s=a("div",["fe_fileexplorer_item_icon"]);t.numitems>1&&(r.dataset.numitems=t.numitems),s.classList.add("fe_fileexplorer_item_icon_"+t.type),r.appendChild(s),d.appendChild(r),document.body.appendChild(d),f={lastx:-9999,lasty:0,xdiff:Math.floor(d.offsetWidth/2),ydiff:Math.floor(d.offsetHeight-8)}}}p++}),!0),window.addEventListener("dragover",(function(e){!d||f.lastx===e.clientX&&f.lasty===e.clientY||(f.lastx=e.clientX,f.lasty=e.clientY,d.style.left=e.clientX-f.xdiff+"px",d.style.top=e.clientY-f.ydiff+"px")}),!0),window.addEventListener("dragleave",D,!0),window.addEventListener("drop",D,!0);var c=function(e){if(!(this instanceof c))return new c(e);var t=!1,r=this;r.xhr=new XMLHttpRequest;r.xhr.addEventListener("loadend",(function(e){r&&(r.xhr=null)})),(e.onsuccess||e.onload)&&r.xhr.addEventListener("load",e.onsuccess||e.onload),e.onerror&&(r.xhr.addEventListener("error",e.onerror),e.onabort||r.xhr.addEventListener("abort",e.onerror),e.ontimeout||r.xhr.addEventListener("timeout",e.onerror)),e.onabort&&r.xhr.addEventListener("abort",e.onabort),e.onloadstart&&r.xhr.addEventListener("loadstart",e.onloadstart),e.onprogress&&r.xhr.addEventListener("progress",e.onprogress),e.ontimeout&&r.xhr.addEventListener("timeout",e.ontimeout),e.onloadend&&r.xhr.addEventListener("loadend",e.onloadend),r.upload={},r.upload.addEventListener=function(e,s,a){!t&&r&&r.xhr&&r.xhr.upload.addEventListener(e,s,a)},r.upload.removeEventListener=function(e,t,s){r&&r.xhr&&r.xhr.upload.removeEventListener(e,t,s)},r.addEventListener=function(e,s,a){!t&&r&&r.xhr&&r.xhr.addEventListener(e,s,a)},r.removeEventListener=function(e,t,s){r&&r.xhr&&r.xhr.removeEventListener(e,t,s)},r.GetMethod=function(){return e.method||(e.params||e.body?"POST":"GET")},r.PrepareBody=function(){if(e.body)return e.body;var t=r.GetMethod(),s=e.params||"POST"===t?new FormData:null;if(e.params)if(e.params instanceof FormData)s=e.params;else if(Array.isArray(e.params))for(var a=0;a<e.params.length;a++)s.append(e.params[a].name,e.params[a].value);else for(var a in e.params)e.params.hasOwnProperty(a)&&("string"!=typeof e.params[a]&&"number"!=typeof e.params[a]||s.append(a,e.params[a]));return s},r.Send=function(s){if(!t&&r&&r.xhr){if(t=!0,r.xhr.open(r.GetMethod(),e.url),e.headers)for(var a in e.headers)e.headers.hasOwnProperty(a)&&"string"==typeof e.headers[a]&&r.xhr.setRequestHeader(a,e.headers[a]);s||(s=r.PrepareBody()),r.xhr.send(s)}},r.Abort=function(){if(r&&r.xhr){var e=r.xhr;r.xhr=null,t&&e.abort()}},r.Destroy=function(){r.Abort(),r=null}},u=function(e){if(!(this instanceof u))return new u(e);var t={},r=0,s={},a=0,n=1,i=1,o=this;o.settings=Object.assign({},{maxactive:10},e);var l=function(e){var s=e.target._ilid,a=t[s];delete t[s],r--,a.img.onload=null,a.img.onerror=null,a.callback&&a.callback.call(o,a,!0,e),o.ProcessQueue()},d=function(e){var s=e.target._ilid,a=t[s];delete t[s],r--,a.img.onload=null,a.img.onerror=null,a.callback&&a.callback.call(o,a,!1,e),o.ProcessQueue()};o.AddToQueue=function(e){e.id&&(e.id in t||e.id in s)||(e.id=i,s[i]=e,a++,i++)},o.ProcessQueue=function(){for(;r<o.settings.maxactive&&a;){for(;n<i&&!s.hasOwnProperty(n);)n++;var e=s[n];delete s[n],a--,t[e.id]=e,r++;var p=e.width&&e.height?new Image(e.width,e.height):new Image;p._ilid=e.id,e.started=Date.now(),e.img=p,p.onload=l,p.onerror=d,p.src=e.src}},o.IsActive=function(e){return e in t},o.RemoveFromQueue=function(e){if(e in s)delete s[e],a--;else if(e in t){var n=t[e];n.img.onload=null,n.img.onerror=null,n.img.src="",delete n.img,delete t[e],r--}},o.Destroy=function(){for(var e in t)t.hasOwnProperty(e)&&(t[e].img.onload=null,t[e].img.onerror=null,t[e].img.src="",delete t[e].img);t={},r=0,s={},a=0,o=null}},m=new u,v=function(e){if(!(this instanceof v))return new v(e);var t={},r=[],s={},a=0,n=[],i=!0,o=this;e[e.length-1][2]||(e[e.length-1][2]={});var l=function(e,r){t[e]&&t[e].forEach((function(e){Array.isArray(r)?e.apply(o,r):e.call(o,r)}))};o.addEventListener=function(e,r){for(var s in t[e]||(t[e]=[]),t[e])if(t[e][s]===r)return;t[e].push(r)},o.removeEventListener=function(e,r){if(t[e])for(var s in t[e])if(t[e][s]===r)return void t[e].splice(s,1)},o.hasEventListener=function(e){return t[e]&&t[e].length},o.lastrefresh=0,o.waiting=!0,o.refs=0,o.SetBusyRef=function(e){for((a+=e)<0&&(a=0);!a&&n.length;){var t=n.shift();t.callback.apply(o,t.callbackopts)}},o.IsBusy=function(){return a>0},o.AddBusyQueueCallback=function(e,t){n.push({callback:e,callbackopts:t}),o.SetBusyRef(0)},o.ClearBusyQueueCallbacks=function(){n=[]},o.GetPath=function(){return e},o.GetPathIDs=function(){for(var t=[],r=0;r<e.length;r++)t.push(e[r][0]);return t},o.SetAttributes=function(t){e[e.length-1][2]=t,l("set_attributes")},o.SetAttribute=function(t,r){e[e.length-1][2][t]=r,l("set_attributes",t)},o.GetAttributes=function(){return e[e.length-1][2]},o.SetAutoSort=function(e){i=!!e},o.SortEntries=function(){if(o.busy)o.busyqueue.push({callback:o.SortEntries,callbackopts:[]});else{var e={numeric:!0,sensitivity:"base"};r.sort((function(t,r){return t.type!==r.type?"folder"===t.type?-1:1:t.name.localeCompare(r.name,undefined,e)}))}},o.SetEntries=function(e){if(o.busy)o.busyqueue.push({callback:o.SetEntries,callbackopts:[e]});else{r=e,i&&o.SortEntries(),s={};for(var t=0;t<r.length;t++)s[r[t].id]=t;o.waiting=!1,l("set_entries")}},o.UpdateEntries=function(e){if(o.busy)o.busyqueue.push({callback:o.UpdateEntries,callbackopts:[e]});else{for(var t=0;t<e.length;t++){var a=e[t];a.id in s?r[s[a.id]]=a:r.push(a)}i&&o.SortEntries(),s={};for(t=0;t<r.length;t++)s[r[t].id]=t;o.waiting=!1,l("set_entries")}},o.SetEntry=function(e){if(o.busy)o.busyqueue.push({callback:o.SetEntry,callbackopts:[e]});else{e.id in s?r[s[e.id]]=e:r.push(e),i&&o.SortEntries(),s={};for(var t=0;t<r.length;t++)s[r[t].id]=t;o.waiting=!1,l("set_entries")}},o.RemoveEntry=function(e){if(o.busy)o.busyqueue.push({callback:o.RemoveEntry,callbackopts:[e]});else if(e in s){var t=s[e];delete s[e],r.splice(t,1);for(var a=t;a<r.length;a++)s[r[a].id]=a;l("remove_entry",t)}},o.GetEntries=function(){return r},o.GetEntryIDMap=function(){return s},o.Destroy=function(){l("destroy"),t={},r=[],s={},a=0,n=[],o.lastrefresh=0,o.waiting=!0,o.refs=0,o=null,e=null}},h=function(e,t){if(!(this instanceof h))return new h(e,t);var r={},s=this,i={items:[],resizewatchers:null,onposition:null,onselchanged:null,onselected:null,oncancel:null,onleft:null,onright:null,ondestroy:null};s.settings=Object.assign({},i,t);for(var o={popupwrap:a("div",["fe_fileexplorer_popup_wrap"],{tabIndex:0}),innerwrap:a("div",["fe_fileexplorer_popup_inner_wrap"])},l=!1,d={},p=0;p<s.settings.items.length;p++){var f=s.settings.items[p];if("split"===f){var c=a("div",["fe_fileexplorer_popup_item_split"]);o.innerwrap.appendChild(c)}else{c=a("div",["fe_fileexplorer_popup_item_wrap"],{tabIndex:-1});var u=a("div",["fe_fileexplorer_popup_item_icon"]),m=a("div",["fe_fileexplorer_popup_item_icon_inner"]),v=a("div",["fe_fileexplorer_popup_item_text"]);!("enabled"in f)||f.enabled||c.classList.add("fe_fileexplorer_popup_item_disabled"),"icon"in f&&m.classList.add(f.icon),v.innerHTML=f.name,u.appendChild(m),c.appendChild(u),c.appendChild(v),c.dataset.itemid=f.id,d[f.id]=f,o.innerwrap.appendChild(c)}}o.popupwrap.appendChild(o.innerwrap),e.appendChild(o.popupwrap);var w=function(e,t){r[e]&&r[e].forEach((function(e){Array.isArray(t)?e.apply(s,t):e.call(s,t)}))};s.addEventListener=function(e,t){for(var s in r[e]||(r[e]=[]),r[e])if(r[e][s]===t)return;r[e].push(t)},s.removeEventListener=function(e,t){if(r[e])for(var s in r[e])if(r[e][s]===t)return void r[e].splice(s,1)},s.hasEventListener=function(e){return r[e]&&r[e].length},s.settings.onposition&&s.addEventListener("position",s.settings.onposition),s.settings.onselchanged&&s.addEventListener("selection_changed",s.settings.onselchanged),s.settings.onselected&&s.addEventListener("selected",s.settings.onselected),s.settings.oncancel&&s.addEventListener("cancelled",s.settings.oncancel),s.settings.onleft&&s.addEventListener("left",s.settings.onleft),s.settings.onright&&s.addEventListener("right",s.settings.onright),s.settings.ondestroy&&s.addEventListener("destroy",s.settings.ondestroy);var _=function(e){if(e.isTrusted){for(var t=e.target;t&&t!==o.popupwrap;)t=t.parentNode;t!==o.popupwrap&&I&&(x=e.target,s.Cancel("focus"===e.type?"focus":"mouse"))}};window.addEventListener("mousedown",_,!0),window.addEventListener("focus",_,!0);var g=function(e){e.target!==window&&e.target!==document||s.Cancel("blur")};window.addEventListener("blur",g,!0);var y=function(e){if(e.isTrusted){e.preventDefault();for(var t=e.target;t&&t.parentNode!==o.innerwrap;)t=t.parentNode;!t||l===t&&l===document.activeElement||(t.classList.contains("fe_fileexplorer_popup_item_wrap")?(t.tabIndex=0,t.focus(),!1!==l&&(l.tabIndex=-1),l!==t&&w("selection_changed",[t.dataset.itemid,d[t.dataset.itemid]]),l=t):o.popupwrap!==document.activeElement&&o.popupwrap.focus())}};o.innerwrap.addEventListener("mousemove",y);var b=function(e){e.isTrusted&&o.popupwrap.focus()};o.innerwrap.addEventListener("mouseleave",b);var x=document.activeElement,L=function(e){I=!1,w("selected",[d[l.dataset.itemid].id,d[l.dataset.itemid],x,e])},E=function(e){e.isTrusted&&(e.preventDefault(),0!=e.button||!1===l||l!==document.activeElement||l.classList.contains("fe_fileexplorer_popup_item_disabled")||L("mouse"))};o.innerwrap.addEventListener("mouseup",E);var T=function(e){e.isTrusted&&e.preventDefault()};o.innerwrap.addEventListener("contextmenu",T);var S=function(e){if(e.stopPropagation(),e.isTrusted)if(37==e.keyCode)e.preventDefault(),w("left",x);else if(39==e.keyCode)e.preventDefault(),w("right",x);else if(38==e.keyCode){e.preventDefault();for(var t=!1===l?o.innerwrap.lastChild:l.previousSibling;t&&!t.classList.contains("fe_fileexplorer_popup_item_wrap");)t=t.previousSibling;t||(t=o.innerwrap.lastChild),t&&(t.tabIndex=0,t.focus(),!1!==l&&(l.tabIndex=-1),l!==t&&w("selection_changed",[t.dataset.itemid,d[t.dataset.itemid]]),l=t),!1!==l&&l.focus()}else if(40==e.keyCode){e.preventDefault();for(t=!1===l?o.innerwrap.firstChild:l.nextSibling;t&&!t.classList.contains("fe_fileexplorer_popup_item_wrap");)t=t.nextSibling;t||(t=o.innerwrap.firstChild),t&&(t.tabIndex=0,t.focus(),!1!==l&&(l.tabIndex=-1),l!==t&&w("selection_changed",[t.dataset.itemid,d[t.dataset.itemid]]),l=t),!1!==l&&l.focus()}else 13==e.keyCode?(e.preventDefault(),!1===l||l!==document.activeElement||l.classList.contains("fe_fileexplorer_popup_item_disabled")?s.Cancel("key"):L("key")):(27==e.keyCode||9==e.keyCode||e.altKey)&&(e.preventDefault(),s.Cancel("key"))};o.popupwrap.addEventListener("keydown",S);var k,C=function(e){e.stopPropagation(),e.isTrusted};o.popupwrap.addEventListener("keyup",C),o.popupwrap.addEventListener("keypress",C),s.UpdatePosition=function(){o.popupwrap.style.left="-9999px",w("position",o.popupwrap)},s.UpdatePosition(),Array.isArray(s.settings.resizewatchers)&&s.settings.resizewatchers.length&&(k=new n({watchers:s.settings.resizewatchers,interval:100,stopsame:5,callback:s.UpdatePosition,intervalcallback:s.UpdatePosition}),window.addEventListener("resize",k.Start,!0));var I=!1;s.Cancel=function(e){I&&(I=!1,w("cancelled",[x,e]))},s.PreventCancel=function(){I=!1},s.Destroy=function(){for(var r in w("destroy"),window.removeEventListener("mousedown",_,!0),window.removeEventListener("focus",_,!0),window.removeEventListener("blur",g,!0),o.innerwrap.removeEventListener("mousemove",y),o.innerwrap.removeEventListener("mouseleave",b),o.innerwrap.removeEventListener("mouseup",E),o.innerwrap.removeEventListener("contextmenu",T),o.popupwrap.removeEventListener("keydown",S),o.popupwrap.removeEventListener("keyup",C),o.popupwrap.removeEventListener("keypress",C),Array.isArray(s.settings.resizewatchers)&&s.settings.resizewatchers.length&&(window.removeEventListener("resize",k.Start,!0),k.Destroy()),o)o[r].parentNode&&o[r].parentNode.removeChild(o[r]);o=null,x=null,s.settings=Object.assign({},i),s=null,e=null,t=null},o.popupwrap.focus(),I=!0},w=function(e,t){if(!(this instanceof w))return new w(e,t);var r={},s=this,i={capturetab:!1,multiline:!1,initvalue:"",initselstart:-1,initselend:-1,resizewatchers:null,onposition:null,ondone:null,oncancel:null,ondestroy:null};s.settings=Object.assign({},i,t);var o={maintext:a("textarea",["fe_fileexplorer_textarea"])};o.maintext.value=s.settings.initvalue,e.appendChild(o.maintext);var l=function(e,t){r[e]&&r[e].forEach((function(e){Array.isArray(t)?e.apply(s,t):e.call(s,t)}))};s.addEventListener=function(e,t){for(var s in r[e]||(r[e]=[]),r[e])if(r[e][s]===t)return;r[e].push(t)},s.removeEventListener=function(e,t){if(r[e])for(var s in r[e])if(r[e][s]===t)return void r[e].splice(s,1)},s.hasEventListener=function(e){return r[e]&&r[e].length},s.settings.onposition&&s.addEventListener("position",s.settings.onposition),s.settings.ondone&&s.addEventListener("done",s.settings.ondone),s.settings.oncancel&&s.addEventListener("cancelled",s.settings.oncancel),s.settings.ondestroy&&s.addEventListener("destroy",s.settings.ondestroy);var d=function(e){if(e.isTrusted){for(var t=e.target;t&&t!==o.maintext;)t=t.parentNode;t!==o.maintext&&v&&(f=e.target,s.Done("focus"===e.type?"focus":"mouse"))}};window.addEventListener("mousedown",d,!0),window.addEventListener("focus",d,!0);var p=function(e){e.target!==window&&e.target!==document||s.Done("blur")};window.addEventListener("blur",p,!0);var f=document.activeElement,c=function(e){if(e.stopPropagation(),e.isTrusted)if(8==e.keyCode&&(s.UpdatePosition(),setTimeout(s.UpdatePosition,0)),46==e.keyCode)s.UpdatePosition(),setTimeout(s.UpdatePosition,0);else if(9==e.keyCode)if(e.preventDefault(),!s.settings.capturetab||e.shiftKey)s.Done("key");else{var t=o.maintext.selectionStart;o.maintext.value=o.maintext.value.substring(0,t)+"\t"+o.maintext.value.substring(o.maintext.selectionEnd),o.maintext.selectionEnd=t+1,s.UpdatePosition(),setTimeout(s.UpdatePosition,0)}else 13==e.keyCode?s.settings.multiline||(e.preventDefault(),s.Done("key")):27==e.keyCode&&(e.preventDefault(),s.Cancel("key"))};o.maintext.addEventListener("keydown",c);var u,m=function(e){e.stopPropagation(),s.UpdatePosition()};o.maintext.addEventListener("keyup",m),o.maintext.addEventListener("keypress",m),s.UpdatePosition=function(){o.maintext.style.height="1px",l("position",o.maintext)},s.UpdatePosition(),Array.isArray(s.settings.resizewatchers)&&s.settings.resizewatchers.length&&(u=new n({watchers:s.settings.resizewatchers,interval:100,stopsame:5,callback:s.UpdatePosition,intervalcallback:s.UpdatePosition}),window.addEventListener("resize",u.Start,!0));var v=!1;s.Done=function(e){s.settings.initvalue===o.maintext.value?s.Cancel(e):v&&(v=!1,o.maintext.readOnly=!0,l("done",[o.maintext.value,f,e]))},s.Cancel=function(e){v&&(v=!1,o.maintext.readOnly=!0,l("cancelled",[f,e]))},s.ResetAllowCancelDone=function(){setTimeout((function(){o.maintext.readOnly=!1,o.maintext.focus(),v=!0}),0)},s.Destroy=function(){for(var r in l("destroy"),window.removeEventListener("mousedown",d,!0),window.removeEventListener("focus",d,!0),window.removeEventListener("blur",p,!0),o.maintext.removeEventListener("keydown",c),o.maintext.removeEventListener("keyup",m),o.maintext.removeEventListener("keypress",m),Array.isArray(s.settings.resizewatchers)&&s.settings.resizewatchers.length&&(window.removeEventListener("resize",u.Start,!0),u.Destroy()),o)o[r].parentNode&&o[r].parentNode.removeChild(o[r]);o=null,f=null,s.settings=Object.assign({},i),s=null,e=null,t=null},o.maintext.focus(),o.maintext.setSelectionRange(s.settings.initselstart>-1?s.settings.initselstart:o.maintext.value.length,s.settings.initselend>-1?s.settings.initselend:o.maintext.value.length),v=!0},_=1,g=[];window.FileExplorer=function(l,d){if(!(this instanceof FileExplorer))return new FileExplorer(l,d);var p={},f=[],u=-1,y={},b=!1,x=!1,L=this,E=_+"_fileexplorer_js_"+Date.now()+"_"+(window.crypto&&window.crypto.getRandomValues?window.crypto.getRandomValues(new Uint32Array(1))[0]:Math.random());_++;var T={group:null,alwaysfocused:!1,capturebrowser:!1,messagetimeout:2e3,displayunits:"iec_windows",adjustprecision:!0,initpath:null,onfocus:null,onblur:null,onrefresh:null,onselchanged:null,onrename:null,onopenfile:null,oninitupload:null,onfinishedupload:null,onuploaderror:null,concurrentuploads:4,tools:{},onnewfolder:null,onnewfile:null,oninitdownload:null,ondownloadstarted:null,ondownloaderror:null,ondownloadurl:null,oncopy:null,onmove:null,ondelete:null,langmap:{}};L.settings=Object.assign({},T,d);var S="string"==typeof L.settings.group?L.settings.group:E;L.Translate=function(e){return L.settings.langmap[e]?L.settings.langmap[e]:e};var k={mainwrap:a("div",["fe_fileexplorer_wrap"]),dropzonewrap:a("div",["fe_fileexplorer_dropzone_wrap"]),innerwrap:a("div",["fe_fileexplorer_inner_wrap"]),toolbar:a("div",["fe_fileexplorer_toolbar"]),navtools:a("div",["fe_fileexplorer_navtools"]),navtool_back:a("button",["fe_fileexplorer_navtool_back","fe_fileexplorer_disabled"],{title:L.Translate("Back (Alt + Left Arrow)"),tabIndex:-1}),navtool_forward:a("button",["fe_fileexplorer_navtool_forward","fe_fileexplorer_disabled"],{title:L.Translate("Forward (Alt + Right Arrow)"),tabIndex:-1}),navtool_history:a("button",["fe_fileexplorer_navtool_history"],{title:L.Translate("Recent locations")}),navtool_up:a("button",["fe_fileexplorer_navtool_up","fe_fileexplorer_disabled"],{title:L.Translate("Up (Alt + Up Arrow)"),tabIndex:-1}),pathwrap:a("div",["fe_fileexplorer_path_wrap"]),pathicon:a("div",["fe_fileexplorer_path_icon"]),pathiconinner:a("div",["fe_fileexplorer_path_icon_inner"]),pathsegmentsscrollwrap:a("div",["fe_fileexplorer_path_segments_scroll_wrap"]),pathsegmentswrap:a("div",["fe_fileexplorer_path_segments_wrap"]),bodywrapouter:a("div",["fe_fileexplorer_body_wrap_outer"]),bodywrap:a("div",["fe_fileexplorer_body_wrap"]),bodytoolsscrollwrap:a("div",["fe_fileexplorer_folder_tools_scroll_wrap","fe_fileexplorer_hidden"]),bodytoolbar:a("div",["fe_fileexplorer_folder_tools"]),bodytools:[],itemsscrollwrap:a("div",["fe_fileexplorer_items_scroll_wrap"],{tabIndex:0}),itemsscrollwrapinner:a("div",["fe_fileexplorer_items_scroll_wrap_inner"]),itemsmessagewrap:a("div",["fe_fileexplorer_items_message_wrap"]),itemswrap:a("div",["fe_fileexplorer_items_wrap","fe_fileexplorer_hidden"]),itemsclipboardoverlaypastewrap:a("div",["fe_fileexplorer_items_clipboard_overlay_paste_wrap","fe_fileexplorer_hidden"]),itemsclipboardoverlaypasteinnerwrap:a("div",["fe_fileexplorer_items_clipboard_overlay_paste_inner_wrap"]),itemsclipboardoverlaypastetextwrap:a("div",["fe_fileexplorer_items_clipboard_overlay_paste_text_wrap"]),itemsclipboardoverlaypastetext:a("div",["fe_fileexplorer_items_clipboard_overlay_paste_text"]),itemsclipboardoverlaypastetextline:a("div",["fe_fileexplorer_items_clipboard_overlay_paste_text_big"],{innerHTML:L.Translate("Paste here")}),itemsclipboardoverlaypastetexthint:a("div",["fe_fileexplorer_items_clipboard_overlay_paste_text_small"]),itemsclipboardoverlay:a("textarea",["fe_fileexplorer_items_clipboard_overlay"],{tabIndex:-1,inputMode:"none",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:!1}),statusbar:a("div",["fe_fileexplorer_statusbar_wrap"]),statusbarmeasuresize:a("div",["fe_fileexplorer_statusbar_measure_em_size"]),statusbartextwrap:a("div",["fe_fileexplorer_statusbar_text_wrap"]),statusbartextsegments:[],statusbartextsegmentmap:{},statusbaractionwrap:a("div",["fe_fileexplorer_action_wrap"]),statusbaractionprogresswrap:a("div",["fe_fileexplorer_action_progress_wrap","fe_fileexplorer_hidden"]),statusbaractionprogressmessagewrap:a("div",["fe_fileexplorer_action_progress_msg_wrap"]),statusbaractionprogressmessagewrap2:a("div",["fe_fileexplorer_action_progress_msg_wrap","fe_fileexplorer_action_progress_msg_wrap_last"]),statusbaractionprogresscancelwrap:a("div",["fe_fileexplorer_action_progress_cancel_wrap"],{title:L.Translate("Cancel all"),tabIndex:0})};L.SetNamedStatusBarText=function(e,t,r){if(!x){if(!(e in k.statusbartextsegmentmap)){k.statusbartextsegmentmap[e]={pos:k.statusbartextsegments.length,timeout:null};var s=a("div",["fe_fileexplorer_statusbar_text_segment_wrap"]);k.statusbartextsegments.push(s),k.statusbartextwrap.appendChild(s)}var n=k.statusbartextsegmentmap[e];n.timeout&&(clearTimeout(n.timeout),n.timeout=null);var i=k.statusbartextsegments[n.pos];if(""===t)i.innerHTML="",i.classList.add("fe_fileexplorer_hidden");else if(i.innerHTML=t,i.classList.remove("fe_fileexplorer_hidden"),r){k.statusbartextsegmentmap[e].timeout=setTimeout((function(){L.SetNamedStatusBarText(e,"")}),r);for(var o=[],l=1.5*k.statusbarmeasuresize.offsetWidth,d=0;d<k.statusbartextsegments.length;d++){var p=k.statusbartextsegments[d];if(p.classList.contains("fe_fileexplorer_hidden"))o.push(0);else{var f=p.currentStyle||window.getComputedStyle(p),c=p.offsetWidth+parseFloat(f.marginLeft)+parseFloat(f.marginRight);o.push(c),l+=c}}for(d=k.statusbartextsegments.length;l>=k.statusbartextwrap.offsetWidth&&d;d--)o[d-1]&&i!==k.statusbartextsegments[d-1]&&(k.statusbartextsegments[d-1].classList.add("fe_fileexplorer_hidden"),l-=o[d-1])}i=null,k.statusbartextsegments.forEach((function(e){r||""===e.innerHTML||e.classList.remove("fe_fileexplorer_hidden"),e.classList.contains("fe_fileexplorer_hidden")||(e.classList.remove("fe_fileexplorer_statusbar_text_segment_wrap_last"),i=e)})),i&&i.classList.add("fe_fileexplorer_statusbar_text_segment_wrap_last")}},L.SetNamedStatusBarText("folder",""),L.SetNamedStatusBarText("selected",""),L.SetNamedStatusBarText("message",""),k.itemsmessagewrap.innerHTML=t(L.Translate("Loading...")),matchMedia("(pointer: coarse)").matches?k.itemsclipboardoverlaypastetexthint.innerHTML=t(L.Translate("Long-press + paste")):navigator.platform.indexOf("Mac")>-1?k.itemsclipboardoverlaypastetexthint.innerHTML=t(L.Translate("⌘ + V   /   Right-click + Paste")):k.itemsclipboardoverlaypastetexthint.innerHTML=t(L.Translate("Ctrl + V   /   Right-click + Paste")),k.navtools.appendChild(k.navtool_back),k.navtools.appendChild(k.navtool_forward),k.navtools.appendChild(k.navtool_history),k.navtools.appendChild(k.navtool_up),k.pathicon.appendChild(k.pathiconinner),k.pathwrap.appendChild(k.pathicon),k.pathsegmentsscrollwrap.appendChild(k.pathsegmentswrap),k.pathwrap.appendChild(k.pathsegmentsscrollwrap),k.toolbar.appendChild(k.navtools),k.toolbar.appendChild(k.pathwrap),k.bodytoolsscrollwrap.appendChild(k.bodytoolbar),k.itemsscrollwrapinner.appendChild(k.itemsmessagewrap),k.itemsscrollwrapinner.appendChild(k.itemswrap),k.itemsscrollwrap.appendChild(k.itemsscrollwrapinner),k.itemsclipboardoverlaypastetext.appendChild(k.itemsclipboardoverlaypastetextline),k.itemsclipboardoverlaypastetext.appendChild(k.itemsclipboardoverlaypastetexthint),k.itemsclipboardoverlaypastetextwrap.appendChild(k.itemsclipboardoverlaypastetext),k.itemsclipboardoverlaypasteinnerwrap.appendChild(k.itemsclipboardoverlaypastetextwrap),k.itemsclipboardoverlaypasteinnerwrap.appendChild(k.itemsclipboardoverlay),k.itemsclipboardoverlaypastewrap.appendChild(k.itemsclipboardoverlaypasteinnerwrap),k.bodywrap.appendChild(k.bodytoolsscrollwrap),k.bodywrap.appendChild(k.itemsscrollwrap),k.bodywrapouter.appendChild(k.bodywrap),k.bodywrapouter.appendChild(k.itemsclipboardoverlaypastewrap),k.statusbaractionprogresswrap.appendChild(k.statusbaractionprogressmessagewrap),k.statusbaractionprogresswrap.appendChild(k.statusbaractionprogressmessagewrap2),k.statusbaractionprogresswrap.appendChild(k.statusbaractionprogresscancelwrap),k.statusbaractionwrap.appendChild(k.statusbaractionprogresswrap),k.statusbar.appendChild(k.statusbarmeasuresize),k.statusbar.appendChild(k.statusbartextwrap),k.statusbar.appendChild(k.statusbaractionwrap),k.innerwrap.appendChild(k.toolbar),k.innerwrap.appendChild(k.bodywrapouter),k.innerwrap.appendChild(k.statusbar),k.dropzonewrap.appendChild(k.innerwrap),k.mainwrap.appendChild(k.dropzonewrap),l.appendChild(k.mainwrap),L.SetNamedStatusBarText("folder",t(L.Translate("Loading...")));var C=function(){k.mainwrap.offsetWidth/k.statusbarmeasuresize.offsetWidth<58?k.statusbar.classList.add("fe_fileexplorer_statusbar_wrap_multiline"):k.statusbar.classList.remove("fe_fileexplorer_statusbar_wrap_multiline")};C();var D=new n({watchers:[{elem:k.mainwrap,attr:"offsetWidth",val:-1}],interval:50,stopsame:5,callback:C,intervalcallback:C});window.addEventListener("resize",D.Start,!0);var F=function(e,t){p[e]&&p[e].forEach((function(e){Array.isArray(t)?e.apply(L,t):e.call(L,t)}))};L.addEventListener=function(e,t){for(var r in p[e]||(p[e]=[]),p[e])if(p[e][r]===t)return;p[e].push(t)},L.removeEventListener=function(e,t){if(p[e])for(var r in p[e])if(p[e][r]===t)return void p[e].splice(r,1)},L.hasEventListener=function(e){return p[e]&&p[e].length},L.DispatchToolEvent=function(e,t){F("tool_"+e,t)},L.addToolEventListener=function(e,t){L.addEventListener("tool_"+e,t)},L.removeToolEventListener=function(e,t){L.removeEventListener("tool_"+e,t)},L.hasToolEventListener=function(e,t){return L.hasEventListener("tool_"+e)},L.settings.onfocus&&L.addEventListener("focus",L.settings.onfocus),L.settings.onblur&&L.addEventListener("blur",L.settings.onblur),L.settings.onrefresh&&L.addEventListener("refresh_folder",L.settings.onrefresh),L.settings.onselchanged&&L.addEventListener("selections_changed",L.settings.onselchanged),L.settings.onrename&&L.addEventListener("rename",L.settings.onrename),L.settings.onopenfile&&L.addEventListener("open_file",L.settings.onopenfile),L.settings.oninitupload&&L.addEventListener("init_upload",L.settings.oninitupload),L.settings.onuploaderror&&L.addEventListener("upload_error",L.settings.onuploaderror),L.settings.onfinishedupload&&L.addEventListener("upload_done",L.settings.onfinishedupload),L.settings.ondownloadurl&&L.addEventListener("get_download_url",L.settings.ondownloadurl),L.settings.oncopy&&L.addEventListener("copy",L.settings.oncopy),L.settings.onmove&&L.addEventListener("move",L.settings.onmove),L.settings.ondelete&&L.addEventListener("delete",L.settings.ondelete);var P=function(e){e.state&&e.state._fileexplorer&&("back"===e.state._fileexplorer?(window.history.forward(),L.HistoryBack(),L.Focus(!0)):"forward"===e.state._fileexplorer&&(window.history.back(),L.HistoryForward(),L.Focus(!0)))},B=0,N=function(t){o||(e=window.history.scrollRestoration),o++,1===++B&&(window.history.scrollRestoration="manual",window.history.pushState({_fileexplorer:"back",_fileexplorerprevscroll:e},document.title),window.history.scrollRestoration="manual",window.history.pushState({_fileexplorer:"main"},document.title),window.history.scrollRestoration="manual",window.history.pushState({_fileexplorer:"forward"},document.title),window.history.scrollRestoration="manual",window.history.back(),window.addEventListener("popstate",P,!0))},G=function(e){o--,--B||(window.removeEventListener("popstate",P,!0),window.history.state&&window.history.state._fileexplorer&&window.history.back())};L.settings.capturebrowser&&(k.mainwrap.addEventListener("mouseenter",N),k.mainwrap.addEventListener("mouseleave",G));var A=function(e){k.innerwrap.classList.add("fe_fileexplorer_inner_wrap_focused");for(var t=document.activeElement;t&&t!==k.mainwrap;)t=t.parentNode;t!==k.mainwrap&&k.itemsscrollwrap.focus()};k.mainwrap.addEventListener("mousedown",A),k.mainwrap.addEventListener("mouseup",A),k.mainwrap.addEventListener("click",A),L.settings.alwaysfocused&&k.innerwrap.classList.add("fe_fileexplorer_inner_wrap_focused");var M=!1,R=function(e){for(var t=e.target;t&&t!==k.mainwrap;)t=t.parentNode;t!==k.mainwrap&&(L.settings.alwaysfocused||k.innerwrap.classList.remove("fe_fileexplorer_inner_wrap_focused"),M&&F("blur",e),M=!1)};window.addEventListener("mousedown",R,!0);var z=function(e){e.target!==window&&e.target!==document||L.settings.alwaysfocused||k.innerwrap.classList.remove("fe_fileexplorer_inner_wrap_focused")};window.addEventListener("blur",z,!0);var O=function(e){if(e.target!==window&&e.target!==document){for(t=e.target;t&&t!==k.itemsscrollwrap&&t!==k.mainwrap;)t=t.parentNode;for(t===k.itemsscrollwrap||e.target===k.itemsclipboardoverlay?k.itemswrap.classList.add("fe_fileexplorer_items_focus"):k.itemswrap.classList.remove("fe_fileexplorer_items_focus");t&&t!==k.mainwrap;)t=t.parentNode;t===k.mainwrap?(k.innerwrap.classList.add("fe_fileexplorer_inner_wrap_focused"),F("focus",e),M=!0):(L.settings.alwaysfocused||k.innerwrap.classList.remove("fe_fileexplorer_inner_wrap_focused"),M&&F("blur",e),M=!1)}else{for(var t=document.activeElement;t&&t!==k.mainwrap;)t=t.parentNode;t===k.mainwrap&&k.innerwrap.classList.add("fe_fileexplorer_inner_wrap_focused")}};window.addEventListener("focus",O,!0),matchMedia("(pointer: coarse)").matches&&k.innerwrap.classList.add("fe_fileexplorer_show_item_checkboxes");var K=function(e){if(e.isTrusted&&"BUTTON"===e.target.tagName)if(38==e.keyCode)for(var t=null,r=0;r<k.bodytools.length;r++){if(0==k.bodytools[r].tabIndex){t?(e.preventDefault(),t.tabIndex=0,t.focus(),k.bodytools[r].tabIndex=-1):k.bodytools[r].focus();break}k.bodytools[r].classList.contains("fe_fileexplorer_disabled")||(t=k.bodytools[r])}else if(40==e.keyCode)for(r=k.bodytools.length;r;r--){if(0==k.bodytools[r-1].tabIndex){t?(e.preventDefault(),t.tabIndex=0,t.focus(),k.bodytools[r-1].tabIndex=-1):k.bodytools[r-1].focus();break}k.bodytools[r-1].classList.contains("fe_fileexplorer_disabled")||(t=k.bodytools[r-1])}};k.bodytoolbar.addEventListener("keydown",K);var U=function(e){var t=e.target;t.parentNode===k.bodytoolbar&&(t.offsetTop-1<k.bodytoolsscrollwrap.scrollTop?k.bodytoolsscrollwrap.scrollTop=t.offsetTop-1:t.offsetTop+t.offsetHeight+1>k.bodytoolsscrollwrap.scrollTop+k.bodytoolsscrollwrap.clientHeight&&(k.bodytoolsscrollwrap.scrollTop=t.offsetTop+t.offsetHeight+1-k.bodytoolsscrollwrap.clientHeight))};k.bodytoolsscrollwrap.addEventListener("focus",U,!0);var H=!1;L.ToolStateUpdated=function(){H=!0};var q=function(){if(H=!1,F("update_tool",[b,b.GetAttributes()]),H){for(var e=!1,t=0;t<k.bodytools.length;t++)if(0==k.bodytools[t].tabIndex){if(k.bodytools[t].classList.contains("fe_fileexplorer_disabled")){for(var r=t;r;r--)if(!k.bodytools[r-1].classList.contains("fe_fileexplorer_disabled")){k.bodytools[r-1].tabIndex=0,document.activeElement===k.bodytools[t]&&k.bodytools[r-1].focus(),e=!0;break}if(!e)for(r=t+1;r<k.bodytools.length;r++)if(!k.bodytools[r].classList.contains("fe_fileexplorer_disabled")){e=!0,k.bodytools[r].tabIndex=0,document.activeElement===k.bodytools[t]&&k.bodytools[r].focus();break}e||document.activeElement!==k.bodytools[t]||L.Focus(!0),k.bodytools[t].tabIndex=-1}else e=!0;break}if(!e)for(t=0;t<k.bodytools.length;t++)if(!k.bodytools[t].classList.contains("fe_fileexplorer_disabled")){k.bodytools[t].tabIndex=0;break}}},j={},W=0,Q=!1,Y=0,J=null;L.ClearSelectedItems=function(e,t){if(b&&b.IsBusy()&&!e)b.AddBusyQueueCallback(L.ClearSelectedItems,[e,t]);else if(b&&!b.waiting){var r;for(var s in j)j.hasOwnProperty(s)&&(r=k.itemswrap.children[j[s]])&&(r.classList.remove("fe_fileexplorer_item_selected"),r.firstChild.firstChild.checked=!1);j={},W=0,t||(q(),ie())}},L.SelectAllItems=function(e){if(b&&b.IsBusy())b.AddBusyQueueCallback(L.SelectAllItems,[e]);else if(b&&!b.waiting){for(var t=0;t<k.itemswrap.children.length;t++){var r=k.itemswrap.children[t];r.dataset.feid in j||(r.classList.add("fe_fileexplorer_item_selected"),r.firstChild.firstChild.checked=!0,j[r.dataset.feid]=t)}W=k.itemswrap.children.length,e||(q(),ie())}},L.ToggleItemSelection=function(e,t,r){if(b&&!b.waiting&&(t||!b.IsBusy())){if("string"==typeof e){if(!(e in(s=b.GetEntryIDMap())))return;e=k.itemswrap.children[s[e]]}if(e.dataset.feid in j)e.classList.remove("fe_fileexplorer_item_selected"),e.firstChild.firstChild.checked=!1,delete j[e.dataset.feid],W--;else{var s=b.GetEntryIDMap();if(e.dataset.feid in s){var a=s[e.dataset.feid];e.classList.add("fe_fileexplorer_item_selected"),e.firstChild.firstChild.checked=!0,j[e.dataset.feid]=a,W++}}r||(q(),ie())}},L.SelectItemsFromLastAnchor=function(e,t){if(b&&!b.waiting&&(e||!b.IsBusy())&&!1!==Q){var r=b.GetEntryIDMap()[Q.dataset.feid];L.ClearSelectedItems(e,!0);var s=Y,a=r;if(s>a){var n=s;s=a,a=n}for(;s<=a;s++){var i=k.itemswrap.children[s];i.classList.add("fe_fileexplorer_item_selected"),i.firstChild.firstChild.checked=!0,j[i.dataset.feid]=s,W++}t||(q(),ie())}},L.SetFocusItem=function(e,t){if(b&&!b.waiting){var r=null;if("string"==typeof e){var s=b.GetEntryIDMap();e in s&&(r=k.itemswrap.children[s[e]])&&(r.classList.add("fe_fileexplorer_item_focused"),r.firstChild.tabIndex=0,r.firstChild.focus(),t&&(Y=s[e]))}!1!==Q&&Q!==r&&(Q.classList.remove("fe_fileexplorer_item_focused"),Q.firstChild.tabIndex=-1,Q=!1),r&&(Q=r)}},L.ScrollToFocusedItem=function(){!1!==Q&&(Q.offsetTop-1<k.itemsscrollwrap.scrollTop?k.itemsscrollwrap.scrollTop=Q.offsetTop-1:Q.offsetTop+Q.offsetHeight+1>k.itemsscrollwrap.scrollTop+k.itemsscrollwrap.clientHeight&&(k.itemsscrollwrap.scrollTop=Q.offsetTop+Q.offsetHeight+1-k.itemsscrollwrap.clientHeight))},L.OpenSelectedItems=function(){if(b&&!b.waiting&&!b.IsBusy()){var e=b.GetEntries(),t=[],r=0,s=null;for(var a in j)j.hasOwnProperty(a)&&t.push(j[a]);t.sort((function(e,t){return e<t?-1:1}));for(a=0;a<t.length;a++){var n=e[t[a]];"folder"===n.type?(s=n,r++):F("open_file",[b,n])}if(1===r){L.Focus(!0);var i=b.GetPath().slice(),o=[s.id,s.name];"attrs"in s&&o.push(s.attrs),i.push(o),L.SetPath(i)}}};var X,V,Z,$,ee={},te={},re=function(e,t){if(X===b)if(t){var r=b.GetEntries(),s=b.GetEntryIDMap();if(e.id in ee&&ee[e.id]in s){var a=s[ee[e.id]],n=k.itemswrap.children[a].firstChild.firstChild.nextSibling;n.className="fe_fileexplorer_item_icon fe_fileexplorer_item_icon_img",n.appendChild(e.img),r[a].thumb=!1}}else te[e.src]=!0},se=function(){if(ne(!1),X!==b){for(var e in X&&ve(X),ee)ee.hasOwnProperty(e)&&(m.RemoveFromQueue(e),delete ee[e]);te={},(X=b).refs++,V=0,Z=$.rows.length?$.rows.length-1:0}var t=b.GetEntryIDMap();for(var e in ee)m.IsActive(e)&&ee[e]in t||(m.RemoveFromQueue(e),delete ee[e]);if($.size){for(var r=k.itemsscrollwrap.scrollTop,s=r+k.itemsscrollwrap.offsetHeight;V&&(V>$.rows.length-1||r<$.rows[V].top);)V--;for(;V<$.rows.length-1&&r>=$.rows[V+1].top;)V++;for(;Z&&(Z>$.rows.length-1||s<$.rows[Z].top);)Z--;for(Z<V&&(Z=V);Z<$.rows.length-1&&s>=$.rows[Z+1].top;)Z++;var a=b.GetEntries(),n=(Z+1)*$.cols.length;n>a.length&&(n=a.length);for(e=V*$.cols.length;e<n;e++)!a[e].thumb||"string"==typeof a[e].thumb&&te[a[e].thumb]||("string"==typeof a[e].thumb&&(a[e].thumb={src:a[e].thumb,callback:re}),m.AddToQueue(a[e].thumb),ee[a[e].thumb.id]=a[e].id);m.ProcessQueue()}},ae=new n({watchers:[{elem:k.itemsscrollwrap,attr:"scrollTop",val:-1},{elem:k.itemsscrollwrapinner,attr:"clientWidth",val:-1}],interval:50,stopsame:10,callback:se});k.itemsscrollwrap.addEventListener("scroll",ae.Start),window.addEventListener("resize",ae.Start,!0);var ne=function(e){if((e||!$||$.lastinnerwidth!==k.itemsscrollwrapinner.clientWidth||$.size!==k.itemswrap.children.length)&&($={lastinnerwidth:k.itemsscrollwrapinner.clientWidth,size:k.itemswrap.children.length,cols:[],rows:[]}).size){for(var t=k.itemswrap.firstChild,r=t.firstChild.offsetTop,s={top:r,bottoms:[]};t;){var a=t.firstChild;a.offsetTop===r&&$.cols.push({left:a.offsetLeft,right:a.offsetLeft+a.offsetWidth}),a.offsetTop!==s.top&&($.rows.push(s),s={top:a.offsetTop,bottoms:[]}),s.bottoms.push(s.top+a.offsetHeight),t=t.nextSibling}s.bottoms.length&&$.rows.push(s)}},ie=function(){var e,a=0,n=0,i=b.GetEntries();for(var o in f[u].lastselected=!1,j)j.hasOwnProperty(o)&&(1==W&&(f[u].lastselected=o),"size"in i[j[o]]&&(a+=i[j[o]].size,n++));n&&(e=s(a,L.settings.adjustprecision,L.settings.displayunits)),0==W?L.SetNamedStatusBarText("selected",""):W>1?n?L.SetNamedStatusBarText("selected",t(r(L.Translate("{0} items selected {1}"),W,e))):L.SetNamedStatusBarText("selected",t(r(L.Translate("{0} items selected"),W))):n?L.SetNamedStatusBarText("selected",t(r(L.Translate("1 item selected {0}"),e))):L.SetNamedStatusBarText("selected",t(L.Translate("1 item selected"))),F("selections_changed",[b,j,W])},oe=function(){q()},le=function(){var e,r=b.GetEntries(),s={},n=k.itemswrap.children;for(e=0;e<n.length;e++)s[n[e].dataset.feid]=[e,n[e].dataset.fehash,n[e],!1];if(u>0&&u===f.length-1&&!0===f[u].lastselected){var i=f[u].folderkeys[f[u].folderkeys.length-1];for(e=0;e<f[u-1].folderkeys.length-1;e++)if(i===f[u-1].folderkeys[e]){var o=y[f[u-1].folderkeys[e+1]].GetPath();f[u].lastselected=o[o.length-1][0];break}}var l,d=!1,p=!1;for(e=0;e<r.length&&s[r[e].id]&&r[e].hash===s[r[e].id][1];e++)l=s[r[e].id][2],s[r[e].id][3]=!0,p||f[u].lastselected!==l.dataset.feid||l.dataset.feid in j||(l.classList.add("fe_fileexplorer_item_selected"),l.firstChild.firstChild.checked=!0,j[l.dataset.feid]=e,W++,d=!0,p=!0);for(var c=k.itemsscrollwrap.scrollTop;e<r.length;e++){var m,v;if(r[e].id in s)l=s[r[e].id][2],s[r[e].id][3]=!0,m=l.firstChild.children[1],v=l.firstChild.lastChild;else{l=a("div",["fe_fileexplorer_item_wrap"]);var h=a("div",["fe_fileexplorer_item_wrap_inner"],{tabIndex:-1,draggable:!0}),w=a("input",["fe_fileexplorer_item_checkbox"],{type:"checkbox",tabIndex:-1});m=a("div",["fe_fileexplorer_item_icon"]),v=a("div",["fe_fileexplorer_item_text"]),h.appendChild(w),h.appendChild(m),h.appendChild(v),l.appendChild(h),l.dataset.feid=r[e].id,l.dataset.fehash=""}if(p||f[u].lastselected!==l.dataset.feid||l.dataset.feid in j||(l.classList.add("fe_fileexplorer_item_selected"),l.firstChild.firstChild.checked=!0,j[l.dataset.feid]=e,W++,d=!0,p=!0),r[e].hash!==l.dataset.fehash){if(m.className="fe_fileexplorer_item_icon",delete m.dataset.ext,"folder"===r[e].type)l.classList.add("fe_fileexplorer_item_folder"),m.classList.add("fe_fileexplorer_item_icon_folder");else{m.classList.add("fe_fileexplorer_item_icon_file");var _=r[e].name,g=_.lastIndexOf(".");if(g<0)m.classList.add("fe_fileexplorer_item_icon_file_no_ext");else if(_=_.substring(g+1).toUpperCase(),m.dataset.ext=_.substring(0,4),""===_)m.classList.add("fe_fileexplorer_item_icon_file_no_ext");else{var x=_.charCodeAt(0);(x>=48&&x<58||x>=64&&x<91)&&m.classList.add("fe_fileexplorer_item_icon_ext_"+_.substring(0,1).toLowerCase())}}if(l.firstChild.className="fe_fileexplorer_item_wrap_inner","overlay"in r[e]){"string"==typeof r[e].overlay&&(r[e].overlay=[r[e].overlay]);for(var E=0;E<r[e].overlay.length;E++)l.firstChild.classList.add(r[e].overlay[E])}"tooltip"in r[e]?l.firstChild.title=r[e].tooltip:l.firstChild.title="",v.innerHTML=t(r[e].name),l.dataset.fehash=r[e].hash}k.itemswrap.appendChild(l)}for(var T in s)s.hasOwnProperty(T)&&!s[T][3]&&(s[T][2].dataset.feid in j&&(delete j[s[T][2].dataset.feid],W--,p=!0),Q===s[T][2]&&(L.HasFocus(!0)&&k.itemsscrollwrap.focus(),Q.classList.remove("fe_fileexplorer_item_focused"),Q.firstChild.tabIndex=-1,Q=!1),s[T][2].parentNode.removeChild(s[T][2]));k.itemsscrollwrap.scrollTop=c,de(d,p)},de=function(e,s){var a=b.GetEntries(),n=b.GetEntryIDMap();for(var i in j)j.hasOwnProperty(i)&&i in n&&(j[i]=n[i]);a.length?(k.itemsmessagewrap.classList.add("fe_fileexplorer_hidden"),k.itemswrap.classList.remove("fe_fileexplorer_hidden")):(b.waiting?k.itemsmessagewrap.innerHTML=t(L.Translate("Loading...")):k.itemsmessagewrap.innerHTML=t(L.Translate("This folder is empty.")),k.itemsmessagewrap.classList.remove("fe_fileexplorer_hidden"),k.itemswrap.classList.add("fe_fileexplorer_hidden")),ne(!0),e?(L.SetFocusItem(f[u].lastselected,!0),L.ScrollToFocusedItem()):!1!==Q&&L.SetFocusItem(Q.dataset.feid,!1),se(),b.waiting?L.SetNamedStatusBarText("folder",t(L.Translate("Loading..."))):L.SetNamedStatusBarText("folder",t(r(L.Translate("{0} items"),a.length))),q(),s&&ie()},pe=function(){this===b&&le()},fe=function(e){var t=k.itemswrap.children[e],r=!1;t.dataset.feid in j&&(delete j[t.dataset.feid],W--,r=!0),Q===t&&(L.HasFocus(!0)&&k.itemsscrollwrap.focus(),Q.classList.remove("fe_fileexplorer_item_focused"),Q.firstChild.tabIndex=-1,Q=!1);var s=k.itemsscrollwrap.scrollTop;t.parentNode.removeChild(t),k.itemsscrollwrap.scrollTop=s,de(!1,r)},ce=function(e){var t=1==e.deltaMode?2*i:2==e.deltaMode?document.documentElement.clientHeight-2*i:1;e.deltaY&&(e.currentTarget.scrollLeft+=e.deltaY*t),e.currentTarget.scrollWidth>e.currentTarget.clientWidth&&e.preventDefault()};k.pathsegmentsscrollwrap.addEventListener("wheel",ce),L.IsValidPath=function(e){if(!e||!Array.isArray(e)||!e.length)return!1;for(var t=0;t<e.length;t++)if(!Array.isArray(e[t])||e[t].length<2||"string"!=typeof e[t][0]||"string"!=typeof e[t][1])return!1;return!0},L.RefreshFolders=function(e){e&&(b.lastrefresh=0);for(var t=f[u],r=Date.now(),s=r-3e5,a=t.folderkeys.length;a;a--)y[t.folderkeys[a-1]].lastrefresh<s&&(F("refresh_folder",[y[t.folderkeys[a-1]],!y[t.folderkeys[a-1]].lastrefresh]),y[t.folderkeys[a-1]].lastrefresh=r)};var ue=function(e){if(e.isTrusted)if(37==e.keyCode){if(e.preventDefault(),document.activeElement&&document.activeElement.parentNode===k.navtools){for(var t=document.activeElement.previousSibling;t&&t.classList.contains("fe_fileexplorer_disabled");)t=t.previousSibling;t&&t.focus()}}else if(39==e.keyCode){if(e.preventDefault(),document.activeElement&&document.activeElement.parentNode===k.navtools){for(t=document.activeElement.nextSibling;t&&t.classList.contains("fe_fileexplorer_disabled");)t=t.nextSibling;t&&t.focus()}}else 40==e.keyCode&&(e.preventDefault(),k.navtool_history.focus(),Dt(e))};k.navtools.addEventListener("keydown",ue);var me=function(e){for(var t="",r=0;r<e.length;r++)t+="/"+e[r][0];return t};L.GetMappedFolderFromPath=function(e){return y[me(e)]};var ve=function(e){if(e.refs--,!e.refs){var t=me(e.GetPath());e.Destroy(),delete y[t]}};L.GetPathIDs=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r][0]);return t},L.SetPath=function(e){if(b&&b.IsBusy())b.AddBusyQueueCallback(L.SetPath,[e]);else if(L.IsValidPath(e)){for(J&&J.Cancel(),b&&(b.removeEventListener("set_attributes",oe),b.removeEventListener("set_entries",pe),b.removeEventListener("remove_entry",fe));k.pathsegmentswrap.firstChild;)k.pathsegmentswrap.removeChild(k.pathsegmentswrap.lastChild);for(var s={folderkeys:[],lastselected:!0},n="",i=0;i<e.length;i++){n+="/"+e[i][0],y[n]||(y[n]=new v(e.slice(0,i+1))),y[n].refs++,s.folderkeys.push(n);var o=a("div",["fe_fileexplorer_path_segment_wrap"],{tabIndex:i<e.length-1?-1:0}),l=a("button",["fe_fileexplorer_path_name"],{tabIndex:-1}),d=a("button",["fe_fileexplorer_path_opts"],{tabIndex:-1});o._fepos=i,l.innerHTML=t(e[i][1]),o.appendChild(l),o.appendChild(d),k.pathsegmentswrap.appendChild(o)}k.pathsegmentsscrollwrap.scrollLeft=k.pathsegmentsscrollwrap.scrollWidth,k.pathsegmentswrap._fepos=e.length-1;var p=b;if((b=y[n]).addEventListener("set_attributes",oe),b.addEventListener("set_entries",pe),b.addEventListener("remove_entry",fe),p===b&&(L.ClearSelectedItems(!1,!0),L.SetFocusItem(!1,!1)),k.itemsscrollwrap.scrollTop=0,b.lastrefresh=0,j={},W=0,Q=!1,Y=0,p!==b)for(;k.itemswrap.firstChild;)document.activeElement===k.itemswrap.lastChild.firstChild&&k.itemsscrollwrap.focus(),k.itemswrap.removeChild(k.itemswrap.lastChild);if(u<0||n!==f[u].folderkeys[f[u].folderkeys.length-1]){for(i=++u;i<f.length;i++)for(var c=0;c<f[i].folderkeys.length;c++)ve(y[f[i].folderkeys[c]]);(f=f.slice(0,u)).push(s),F("history_changed")}else if(u>-1)for(i=0;i<f[u].folderkeys.length;i++)ve(y[f[u].folderkeys[i]]);var m=f[u].lastselected;le(),W||ie(),f[u].lastselected=m,L.RefreshFolders(!0),function(){if(u<=0)document.activeElement===k.navtool_back&&(u>=f.length-1?k.navtool_history.focus():(k.navtool_forward.tabIndex=0,k.navtool_forward.focus())),k.navtool_back.classList.add("fe_fileexplorer_disabled"),k.navtool_back.tabIndex=-1,k.navtool_back.title=L.Translate("Back (Alt + Left Arrow)");else{k.navtool_back.classList.remove("fe_fileexplorer_disabled"),k.navtool_back.tabIndex=0;var e=y[f[u-1].folderkeys[f[u-1].folderkeys.length-1]].GetPath();k.navtool_back.title=r(L.Translate('Back to "{0}" (Alt + Left Arrow)'),e[e.length-1][1])}if(u>=f.length-1)document.activeElement===k.navtool_forward&&(u<=0?k.navtool_history.focus():k.navtool_back.focus()),k.navtool_forward.classList.add("fe_fileexplorer_disabled"),k.navtool_forward.tabIndex=-1,k.navtool_forward.title=L.Translate("Forward (Alt + Right Arrow)");else{k.navtool_forward.classList.remove("fe_fileexplorer_disabled"),k.navtool_forward.tabIndex=0;var t=y[f[u+1].folderkeys[f[u+1].folderkeys.length-1]].GetPath();k.navtool_forward.title=r(L.Translate('Forward to "{0}" (Alt + Right Arrow)'),t[t.length-1][1])}var s=b.GetPath();s.length<=1?(document.activeElement===k.navtool_up&&k.navtool_history.focus(),k.navtool_up.classList.add("fe_fileexplorer_disabled"),k.navtool_up.tabIndex=-1,k.navtool_up.title=L.Translate("Up (Alt + Up Arrow)")):(k.navtool_up.classList.remove("fe_fileexplorer_disabled"),k.navtool_up.tabIndex=0,k.navtool_up.title=r(L.Translate('Up to "{0}" (Alt + Up Arrow)'),s[s.length-2][1])),F("navigated"),q()}()}};var he,we,_e=null,ge=null,ye=null,be=!1,xe=null,Le=null,Ee=null,Te=null,Se=!1,ke=function(e,t){for(e.startrow=t?t.startrow:0,e.startcol=t?t.startcol:0,e.endrow=t?t.endrow:$.rows.length?$.rows.length-1:0,e.endcol=t?t.endcol:$.rows.length?$.cols.length-1:0;e.startrow&&e.top<$.rows[e.startrow].top;)e.startrow--;for(;e.startrow<$.rows.length-1&&e.top>=$.rows[e.startrow+1].top;)e.startrow++;for(;e.endrow&&e.bottom<$.rows[e.endrow].top;)e.endrow--;for(e.endrow<e.startrow&&(e.endrow=e.startrow);e.endrow<$.rows.length-1&&e.bottom>=$.rows[e.endrow+1].top;)e.endrow++;for(;e.startcol&&e.left<$.cols[e.startcol].left;)e.startcol--;for(;e.startcol<$.cols.length-1&&e.left>=$.cols[e.startcol+1].left;)e.startcol++;for(;e.endcol&&e.right<$.cols[e.endcol].left;)e.endcol--;for(e.endcol<e.startcol&&(e.endcol=e.startcol);e.endcol<$.cols.length-1&&e.right>=$.cols[e.endcol+1].left;)e.endcol++},Ce=function(e,t,r){return $.size&&e.left<$.cols[t].right&&e.right>=$.cols[t].left&&e.bottom>=$.rows[r].top&&e.top<$.rows[r].bottoms[t]},Ie=function(e,t,r,s,a){a||(e.left=t.x<_e.x?t.x:_e.x),e.top=t.y<_e.y?t.y:_e.y,a||(e.right=e.left+r),e.bottom=e.top+s,ke(e,ge),a||(ye.style.left=e.left+"px"),ye.style.top=e.top+"px",a||(ye.style.width=r+"px"),ye.style.height=s+"px";var n={},i=!1;if(!a){var o=e.startrow<ge.startrow?e.startrow:ge.startrow,l=e.endrow>ge.endrow?e.endrow:ge.endrow;if(e.left<ge.left)for(var d=o;d<=l;d++)for(var p=e.startcol;p<=ge.startcol;p++)!Ce(ge,p,d)&&Ce(e,p,d)&&(n[d*$.cols.length+p]=!0,i=!0);else if(e.left>ge.left)for(d=o;d<=l;d++)for(p=ge.startcol;p<=e.startcol;p++)Ce(ge,p,d)&&!Ce(e,p,d)&&(n[d*$.cols.length+p]=!1,i=!0);if(e.right>ge.right)for(d=o;d<=l;d++)for(p=ge.endcol;p<=e.endcol;p++)!Ce(ge,p,d)&&Ce(e,p,d)&&(n[d*$.cols.length+p]=!0,i=!0);else if(e.right<ge.right)for(d=o;d<=l;d++)for(p=e.endcol;p<=ge.endcol;p++)Ce(ge,p,d)&&!Ce(e,p,d)&&(n[d*$.cols.length+p]=!1,i=!0)}var f=e.startcol<ge.startcol?e.startcol:ge.startcol,c=e.endcol>ge.endcol?e.endcol:ge.endcol;if(e.top<ge.top)for(d=e.startrow;d<=ge.startrow;d++)for(p=f;p<=c;p++)!Ce(ge,p,d)&&Ce(e,p,d)&&(n[d*$.cols.length+p]=!0,i=!0);else if(e.top>ge.top)for(d=ge.startrow;d<=e.startrow;d++)for(p=f;p<=c;p++)Ce(ge,p,d)&&!Ce(e,p,d)&&(n[d*$.cols.length+p]=!1,i=!0);if(e.bottom>ge.bottom)for(d=ge.endrow;d<=e.endrow;d++)for(p=f;p<=c;p++)!Ce(ge,p,d)&&Ce(e,p,d)&&(n[d*$.cols.length+p]=!0,i=!0);else if(e.bottom<ge.bottom)for(d=e.endrow;d<=ge.endrow;d++)for(p=f;p<=c;p++)Ce(ge,p,d)&&!Ce(e,p,d)&&(n[d*$.cols.length+p]=!1,i=!0);if(i){for(var p in n)if(n.hasOwnProperty(p)){var u=k.itemswrap.children[p];be?u.dataset.feid in j?(u.classList.remove("fe_fileexplorer_item_selected"),u.firstChild.firstChild.checked=!1,delete j[u.dataset.feid],W--):(u.classList.add("fe_fileexplorer_item_selected"),u.firstChild.firstChild.checked=!0,j[u.dataset.feid]=p,W++):n[p]?(u.classList.add("fe_fileexplorer_item_selected"),u.firstChild.firstChild.checked=!0,j[u.dataset.feid]=p,W++):(u.classList.remove("fe_fileexplorer_item_selected"),u.firstChild.firstChild.checked=!1,delete j[u.dataset.feid],W--)}q(),ie()}Object.assign(ge,e)},De=function(e){if(e.isTrusted){e.preventDefault(),Le=e;var t=k.itemsscrollwrapinner.getBoundingClientRect(),r={x:e.clientX-t.left,y:e.clientY-t.top};r.x<0&&(r.x=0),r.x>t.width&&(r.x=t.width),r.y<0&&(r.y=0),r.y>t.height&&(r.y=t.height);var s=Math.abs(r.x-_e.x),n=Math.abs(r.y-_e.y);if(!ye&&(s>8||n>8)&&(ye=a("div",["fe_fileexplorer_select_box"]),k.itemsscrollwrapinner.appendChild(ye)),ye){e.ctrlKey?be=!0:e.shiftKey&&(be=!1);var i={};Ie(i,r,s,n,!1);var o=k.itemsscrollwrap.getBoundingClientRect();if(xe&&(clearInterval(xe),xe=null),e.clientY<o.top){var l=Math.floor((o.top-e.clientY)/10)+1,d=function(e){k.itemsscrollwrap.scrollTop-=l,r.y-=l,r.y<0&&(r.y=0),n=Math.abs(r.y-_e.y),Ie(i,r,s,n,!0),k.itemsscrollwrap.scrollTop<=0&&(clearInterval(xe),xe=null)};xe=setInterval(d,10),d()}else if(e.clientY>o.bottom){l=Math.floor((e.clientY-o.bottom)/10)+1;var p=function(e){k.itemsscrollwrap.scrollTop+=l,r.y+=l,r.y>t.height&&(r.y=t.height),n=Math.abs(r.y-_e.y),Ie(i,r,s,n,!0),k.itemsscrollwrap.scrollTop>=k.itemsscrollwrap.scrollHeight-k.itemsscrollwrap.clientHeight&&(clearInterval(xe),xe=null)};xe=setInterval(p,10),p()}}}},Fe=function(e){if(e.isTrusted){var t=-1,r=0,s=function(){De(Le),xe&&clearInterval(xe),xe=setInterval(s,10),t!==k.itemsscrollwrap.scrollTop?r=0:++r>=5&&(clearInterval(xe),xe=null),t=k.itemsscrollwrap.scrollTop};s()}},Pe=function(e){e.ctrlKey||e.metaKey||93==e.keyCode||Be(e)},Be=function(e){window.removeEventListener("focus",Be,!0),k.itemsclipboardoverlay.removeEventListener("keyup",Pe),window.removeEventListener("mousedown",Be,!0),k.itemsclipboardoverlay.removeEventListener("input",Be,!0),k.itemsclipboardoverlay.removeEventListener("select",Be,!0),window.removeEventListener("keydown",Ae,!0),window.removeEventListener("mousedown",Me,!0),he&&(clearTimeout(he),he=null),e&&e.target===k.itemsclipboardoverlay&&L.Focus(!0,!0),k.itemsclipboardoverlaypastewrap.classList.add("fe_fileexplorer_hidden"),k.itemsclipboardoverlaypastewrap.classList.remove("fe_fileexplorer_items_show_clipboard_overlay_paste"),k.itemsclipboardoverlay.tabIndex=-1,we=!1},Ne=function(e){he&&clearTimeout(he),he=setTimeout((function(){he=null,k.itemsclipboardoverlaypastewrap.classList.remove("fe_fileexplorer_items_clipboard_contextmenu"),k.itemsclipboardoverlay.addEventListener("input",Be,!0),k.itemsclipboardoverlay.addEventListener("select",Be,!0)}),0),window.addEventListener("focus",Be,!0),k.itemsclipboardoverlay.addEventListener("keyup",Pe),window.addEventListener("mousedown",Be,!0),window.removeEventListener("contextmenu",Ne,!0),we=!0},Ge=function(){k.itemsclipboardoverlaypastewrap.classList.contains("fe_fileexplorer_items_clipboard_contextmenu")&&(window.addEventListener("contextmenu",Ne,!0),k.itemsclipboardoverlay.focus(),k.itemsclipboardoverlay.setSelectionRange(W?1:2,2))},Ae=function(e){k.itemsclipboardoverlay.value="   ",k.itemsclipboardoverlay.setSelectionRange(2,2),27==e.keyCode&&Be(e)},Me=function(e){e.target!==k.itemsclipboardoverlay&&Be(e)};L.ShowClipboardPasteBox=function(){k.itemsclipboardoverlaypastewrap.classList.add("fe_fileexplorer_items_show_clipboard_overlay_paste"),k.itemsclipboardoverlaypastewrap.classList.remove("fe_fileexplorer_hidden"),k.itemsclipboardoverlay.tabIndex=0,window.addEventListener("keydown",Ae,!0),window.addEventListener("mousedown",Me,!0)},L.HideClipboardPasteBox=function(e){Be(e)};var Re,ze,Oe,Ke=function(e){ye&&(ye.parentNode.removeChild(ye),ye=null,clearInterval(xe),xe=null),k.itemswrap.classList.remove("fe_fileexplorer_items_selecting"),Ge(),window.removeEventListener("mousemove",De,!0),window.removeEventListener("mouseup",Ke,!0),window.removeEventListener("blur",Ke,!0),k.itemsscrollwrap.removeEventListener("wheel",Fe),b.SetBusyRef(-1)},Ue=!1,He=function(){Oe=null,qe(),Re===b&&!b.IsBusy()&&1===W&&ze in j&&L.RenameSelectedItem()},qe=function(e){window.removeEventListener("touchstart",qe,!0),window.removeEventListener("mousedown",qe,!0),window.removeEventListener("keydown",qe,!0),Oe&&(clearTimeout(Oe),Oe=null)},je=null,We=function(e){e.preventDefault(),je&&(2==je.origevent.button||(je.origevent.ctrlKey||"INPUT"===je.origevent.target.tagName||Se?L.ToggleItemSelection(je.origelem,!0):je.origevent.shiftKey||L.SelectItemsFromLastAnchor(!0)),W?Ee&&"INPUT"===je.origevent.target.tagName&&(Se=!0):Se=!1,je=null),L.ScrollToFocusedItem(),window.removeEventListener("mouseup",We,!0),Ge(),Ue&&(Oe=setTimeout(He,500),window.addEventListener("touchstart",qe,!0),window.addEventListener("mousedown",qe,!0),window.addEventListener("keydown",qe,!0))},Qe=function(e){if(e.isTrusted)if(je&&((je.origevent.ctrlKey||"INPUT"===je.origevent.target.tagName||2==je.origevent.button||Se)&&L.SetSelectedItems([je.origelem.dataset.feid],!0),je=null),window.removeEventListener("mouseup",We,!0),k.itemsclipboardoverlaypastewrap.classList.remove("fe_fileexplorer_items_clipboard_contextmenu"),k.itemsclipboardoverlaypastewrap.classList.add("fe_fileexplorer_hidden"),W){k.innerwrap.classList.add("fe_fileexplorer_drag_source");var t,r=[];if(!1===Q)t="file";else t=(a=b.GetEntries()[b.GetEntryIDMap()[Q.dataset.feid]]).type;for(var s in j)j.hasOwnProperty(s)&&r.push(s);if(e.dataTransfer.setDragImage(new Image,9999,0),e.dataTransfer.setData("application/file-explorer-icon;"+JSON.stringify({group:S,numitems:W,type:t}),""),e.dataTransfer.setData("application/file-explorer-folder",JSON.stringify({source:E,path:b.GetPath(),ids:r})),L.hasEventListener("get_download_url")){var a=b.GetEntries()[b.GetEntryIDMap()[r[0]]],n={};F("get_download_url",[n,b,r,a]),n&&n.name&&n.url&&e.dataTransfer.setData("DownloadURL","application/octet-stream:"+n.name+":"+n.url)}}else e.preventDefault()},Ye=function(e){k.innerwrap.classList.remove("fe_fileexplorer_drag_source")};k.itemswrap.addEventListener("dragstart",Qe),k.itemswrap.addEventListener("dragend",Ye);var Je,Xe=0,Ve=!1,Ze=function(e,s){if("none"!==Ve.dropeffect){var a=e.ctrlKey||"copy"===Ve.dropeffect?s?"Copying":"Copy":s?"Moving":"Move";if(a+=1===Ve.numitems?" 1 item":" {0} items",Ve.dropallowed)if("currfolder"===Ve.lasttype){var n=b.GetPath();L.SetNamedStatusBarText("selected",t(r(L.Translate(a+' to "{1}"...'),Ve.numitems,n[n.length-1][1])))}else if("path"===Ve.lasttype){n=b.GetPath();L.SetNamedStatusBarText("selected",t(r(L.Translate(a+' to "{1}"...'),Ve.numitems,n[Ve.lastnode._fepos][1])))}else{var i=b.GetEntries()[b.GetEntryIDMap()[Ve.lastnode.dataset.feid]];L.SetNamedStatusBarText("selected",t(r(L.Translate(a+' to "{1}"...'),Ve.numitems,i.name)))}else L.SetNamedStatusBarText("selected",t(r(L.Translate(a+"..."),Ve.numitems)))}},$e=function(e){if(e.isTrusted){if(!Xe)if(!1!==(Ve=I(e,S)))Ve.issource=k.innerwrap.classList.contains("fe_fileexplorer_drag_source"),Ve.lastnode=null,Ve.lasttype="error",Ve.dropallowed=!1,Ve.dropeffect="auto",Ze(e),b.SetBusyRef(1);else for(var t=0;t<e.dataTransfer.types.length;t++)if("Files"===e.dataTransfer.types[t]){Ve={group:S,numitems:"",type:"file",issource:!1,lastnode:null,lasttype:"error",dropallowed:!1,dropeffect:L.hasEventListener("init_upload")?"copy":"none"},Ze(e),b.SetBusyRef(1);break}if(!1!==Ve&&(e.preventDefault(),"none"!==Ve.dropeffect)){var r=function(e){for(var t=e.target;t&&t.parentNode&&t.parentNode!==k.pathsegmentswrap&&t.parentNode.parentNode!==k.itemswrap&&t!==k.innerwrap;)t=t.parentNode;return t?t===k.innerwrap?{node:null,type:"currfolder"}:t.parentNode?t.parentNode.parentNode===k.itemswrap?t.parentNode.classList.contains("fe_fileexplorer_item_folder")?{node:t.parentNode,type:"item"}:{node:null,type:"currfolder"}:t.parentNode===k.pathsegmentswrap?{node:t,type:"path"}:void 0:{node:null,type:"error"}:{node:null,type:"error"}}(e);r.node===Ve.lastnode&&r.type===Ve.lasttype||(Ve.lastnode&&Ve.lastnode.classList.remove("fe_fileexplorer_drag_hover"),Ve.lastnode=r.node,Ve.lasttype=r.type,Ve.lastnode?(Ve.lastnode.classList.add("fe_fileexplorer_drag_hover"),Ve.dropallowed=!Ve.issource||"item"!=Ve.lasttype||!(Ve.lastnode.dataset.feid in j)):Ve.dropallowed=!Ve.issource&&"currfolder"===Ve.lasttype,Ze(e))}Xe++}},et=function(e){if(e.isTrusted&&!1!==Ve){e.preventDefault();var t=e.dataTransfer.dropEffect;"auto"!==Ve.dropeffect?e.dataTransfer.dropEffect=Ve.dropeffect:e.ctrlKey?e.dataTransfer.dropEffect=L.hasEventListener("copy")?"copy":"none":e.dataTransfer.dropEffect=L.hasEventListener("move")?"move":"none",t!==e.dataTransfer.dropEffect&&Ze(e)}},tt=function(e){e.isTrusted&&--Xe<1&&(Xe=0,Ve.lastnode&&Ve.lastnode.classList.remove("fe_fileexplorer_drag_hover"),ie(),b.SetBusyRef(-1),Ve=!1)},rt=function(e,s,a,n,i){var o,l=b,d=Object.assign({},j);if("currfolder"===s)o=b;else if("path"===s)o=L.GetMappedFolderFromPath(b.GetPath().slice(0,a._fepos+1));else if("item"===s){var p=b.GetEntries()[b.GetEntryIDMap()[a.dataset.feid]],f=b.GetPath().slice(),c=[p.id,p.name];"attrs"in p&&c.push(p.attrs),f.push(c);var u=me(f);y[u]||(y[u]=new v(f)),o=y[u]}o.refs++;var m=!1;"copy"===n&&b.SetBusyRef(-1),L.StartOperationIndicator(),F(n,[function(s,a){if(!m&&!x){if(m=!0,L.StopOperationIndicator(),ve(o),ie(),"move"===n&&b.SetBusyRef(-1),!0===s){if(e&&b===l&&o!==b&&"move"===n){for(var i=b.GetEntries(),p=[],f=0;f<i.length;f++)i[f].id in d||p.push(i[f]);if(!1!==Q&&Q.dataset.feid in d){for(var c=Q.nextSibling;c&&c.dataset.feid in d;)c=c.nextSibling;if(!c)for(c=Q.previousSibling;c&&c.dataset.feid in d;)c=c.previousSibling;c&&(L.SetFocusItem(c.dataset.feid,!0),L.ScrollToFocusedItem())}b.SetEntries(p)}}else L.SetNamedStatusBarText("message",t(r(L.Translate(("copy"===n?"Copying":"Moving")+" items failed."+("string"==typeof s?"  {0}":"")),s)),L.settings.messagetimeout);if(L.IsMappedFolder(o)&&a&&Array.isArray(a)){i=o.GetEntries();var u=o.GetEntryIDMap();for(f=0;f<a.length;f++)a[f].id in u?i[u[a[f].id]]=a[f]:i.push(a[f]);if(o.SetEntries(i),o===b){var v=[];for(f=0;f<a.length;f++)v.push(a[f].id);L.SetSelectedItems(v)}}L.RefreshFolders(!0)}},i.path,i.ids,o])},st=[],at=function(){return{started:Date.now(),totalbytes:0,showbyterate:!1,uploading:!1,queueditems:0,queuesizeunknown:!1,itemsdone:0,faileditems:0,cancelcallback:null}};L.UpdateProgressText=function(){if(st&&st.length){for(var e=at(),a=e.started,n=0;n<st.length;n++)e.totalbytes+=st[n].totalbytes,!1!==st[n].showbyterate&&(e.showbyterate=!0,e.started>st[n].started&&(e.started=st[n].started)),!1!==st[n].uploading&&(!1===e.uploading&&(e.uploading=0),e.uploading+=st[n].uploading),e.queueditems+=st[n].queueditems,!1!==st[n].queuesizeunknown&&(e.queuesizeunknown=!0),e.itemsdone+=st[n].itemsdone,e.faileditems+=st[n].faileditems;var i=s(e.totalbytes,L.settings.adjustprecision,L.settings.displayunits);if(e.showbyterate&&a>e.started+3e3){var o=e.totalbytes/((a-e.started)/1e3),l=r(L.Translate("{0}/s"),s(o,L.settings.adjustprecision,L.settings.displayunits));k.statusbaractionprogressmessagewrap.innerHTML=t(r("{0}   {1}",l,i))}else k.statusbaractionprogressmessagewrap.innerHTML=t(r("{0}",i));var d=[],p=[];!1!==e.uploading&&(d.push(L.Translate('{0} <span class="fe_fileexplorer_action_progress_msg_icon fe_fileexplorer_action_progress_msg_icon_uploads_in_progress"></span>')),p.push(L.Translate("{0} uploading"))),e.queueditems&&(d.push(L.Translate((e.queuesizeunknown?"{1}+ ":"{1} ")+'<span class="fe_fileexplorer_action_progress_msg_icon fe_fileexplorer_action_progress_msg_icon_queued"></span>')),p.push(L.Translate(e.queuesizeunknown?"{1}+ queued":"{1} queued"))),e.itemsdone&&(d.push(L.Translate('{2} <span class="fe_fileexplorer_action_progress_msg_icon fe_fileexplorer_action_progress_msg_icon_done"></span>')),p.push(L.Translate("{2} done"))),e.faileditems&&(d.push(L.Translate('{3} <span class="fe_fileexplorer_action_progress_msg_icon fe_fileexplorer_action_progress_msg_icon_errors"></span>')),p.push(L.Translate("{3} failed"))),k.statusbaractionprogressmessagewrap2.innerHTML=r(d.join("   "),e.uploading,e.queueditems,e.itemsdone,e.faileditems),k.statusbaractionprogressmessagewrap2.title=t(r(p.join(", "),e.uploading,e.queueditems,e.itemsdone,e.faileditems))}};var nt=function(e){if(e){if(!e.isTrusted)return;e.preventDefault()}L.SetNamedStatusBarText("message",t(L.Translate("Stopping...")),L.settings.messagetimeout);for(var r=0;r<st.length;r++)st[r].cancelcallback&&st[r].cancelcallback.call(L,e);L.Focus(!0,!0),k.statusbaractionprogresscancelwrap.classList.add("fe_fileexplorer_hidden")};k.statusbaractionprogresscancelwrap.addEventListener("click",nt);var it=function(e){e.isTrusted&&(13!=e.keyCode&&32!=e.keyCode||nt(e))};k.statusbaractionprogresscancelwrap.addEventListener("keydown",it);var ot=function(){k.statusbaractionprogresswrap.classList.add("fe_fileexplorer_hidden"),k.statusbaractionprogressmessagewrap.innerHTML="",L.SetNamedStatusBarText("message",""),clearInterval(Je),Je=null},lt=function(e){window.removeEventListener("touchstart",lt,!0),window.removeEventListener("mousemove",lt,!0),window.removeEventListener("mousedown",lt,!0),window.removeEventListener("keydown",lt,!0),e&&(Je=setInterval(ot,1e3))};L.CreateProgressTracker=function(e){var t=at();return t.cancelcallback=e,st.push(t),Je&&clearInterval(Je),Je=setInterval(L.UpdateProgressText,1e3),lt(),L.UpdateProgressText(),e&&k.statusbaractionprogresscancelwrap.classList.remove("fe_fileexplorer_hidden"),k.statusbaractionprogresswrap.classList.remove("fe_fileexplorer_hidden"),t},L.RemoveProgressTracker=function(e,t){L.UpdateProgressText();for(var r=0;r<st.length;r++)if(st[r]===e){st.splice(r,1);break}var s=!1;for(r=0;r<st.length;r++)st[r].cancelcallback&&(s=!0);s||k.statusbaractionprogresscancelwrap.classList.add("fe_fileexplorer_hidden"),st.length||(Je&&(clearInterval(Je),Je=null),window.addEventListener("touchstart",lt,!0),window.addEventListener("mousemove",lt,!0),window.addEventListener("mousedown",lt,!0),window.addEventListener("keydown",lt,!0),t&&L.SetNamedStatusBarText("message",L.Translate(t)))};var dt,pt=[],ft=[],ct=[],ut=!1,mt=!1,vt=!1,ht=function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},wt=function(e){if(e){if(!e.isTrusted)return;e.preventDefault()}vt=!0;for(var t=pt.length;t;t--)pt[t-1].xhr&&pt[t-1].xhr.Abort();dt&&(clearInterval(dt),dt=null)},_t=function(){L.RefreshFolders(!0)},gt=function(){mt&&(mt.uploading=pt.length,mt.queueditems=ft.length,mt.queuesizeunknown=ct.length>0)},yt=function(e){for(var t=0;t<pt.length;t++)if(pt[t]===e){ve(e.folder),pt.splice(t,1),e.xhr&&(e.xhr.Destroy(),delete e.xhr);break}gt(),St()},bt=function(e,t,r){e.status=t,mt.faileditems++,F("upload_error",[e,r]),yt(e)},xt=function(e){if(vt)bt(e,"request_aborted");else{var s=e.chunksize?"function"==typeof e.chunksize?e.chunksize(e):e.chunksize:e.sizebytes-e.currchunkstart;e.currchunkstart+s>e.sizebytes&&(s=e.sizebytes-e.currchunkstart),!e.currchunkstart&&s<e.sizebytes&&s>4096&&(s=4096),"file"===e.type&&(e.currblob=ht.call(e.file,e.currchunkstart,e.currchunkstart+s,e.file.type),s=e.currblob.size),e.currchunksize=s;var a=b,n=function(t){e.retriesleft?(e.retriesleft--,xt(e)):bt(e,"request_failed",t)};e.xhr=new c(e),F("update_upload_fileinfo",e),e.xhr.upload.addEventListener("loadstart",(function(t){e.status="upload_started",e.progress.uploadedchunkbytes=0})),e.xhr.upload.addEventListener("progress",(function(t){e.status="upload_in_progress";var r=t.loaded-e.progress.uploadedchunkbytes;mt.totalbytes+=r,e.progress.uploadedbytes+=r,e.progress.uploadedchunkbytes=t.loaded;var s=Date.now();s>e.progress.started+3e3&&(e.progress.byterate=e.progress.uploadedbytes/(s-e.progress.started)),e.progress.percent=t.lengthComputable?t.loaded/t.total*100:e.currchunksize?t.loaded/e.currchunksize:0})),e.xhr.upload.addEventListener("load",(function(t){e.status="upload_complete",e.progress.uploadedbytes<e.currchunksize&&(mt.trackerbytes+=e.currchunksize-e.progress.uploadedbytes)})),e.xhr.addEventListener("load",(function(s){try{var i=JSON.parse(s.target.responseText);if(e.currchunkstart+=e.currchunksize,i.success)if(e.currchunkstart<e.sizebytes)e.retriesleft=e.retries,xt(e);else if(L.hasEventListener("upload_done")){i.entry&&L.IsMappedFolder(a)&&a.SetEntry(i.entry),a=b;var o=!1;F("upload_done",[function(s,n){o||(o=!0,n&&L.IsMappedFolder(a)&&a.SetEntry(n),!0===s?(mt.itemsdone++,yt(e)):(L.SetNamedStatusBarText("message",t(r(L.Translate('Finalizing "{0}" failed.'+("string"==typeof s?"  {1}":"")),e.fullPath,s)),L.settings.messagetimeout),bt(e,"finalize_failed")))},e])}else i.entry&&L.IsMappedFolder(a)&&a.SetEntry(i.entry),mt.itemsdone++,yt(e);else L.SetNamedStatusBarText("message",t(r(L.Translate('Error uploading "{0}" ({1})'),e.fullPath,i.errorcode)),5*L.settings.messagetimeout),bt(e,"request_error",s)}catch(s){n(s)}})),e.xhr.addEventListener("error",n),e.xhr.addEventListener("timeout",n),e.xhr.addEventListener("abort",(function(t){bt(e,"request_aborted",t)})),e.method="POST",e.headers=e.headers||{},"file"===e.type&&(e.currchunkstart||e.currchunksize<e.sizebytes)&&(e.currchunksize?e.headers["Content-Range"]="bytes "+e.currchunkstart+"-"+(e.currchunkstart+e.currchunksize-1)+"/"+e.sizebytes:e.headers["Content-Range"]="bytes 1-0/"+e.sizebytes,e.headers["Content-Disposition"]='attachment; filename="'+encodeURI(e.name||e.file.name)+'"'),e.headers.Accept="application/json";var i=e.xhr.PrepareBody();e.currpathparam&&i.append(e.currpathparam,JSON.stringify(b.GetPathIDs())),"file"===e.type&&i.append(e.fileparam,e.currblob,e.name||e.file.name),e.xhr.Send(i)}},Lt=function(e){var s=!1;gt(),L.UpdateProgressText(),ut||(ut=Date.now()),F("init_upload",[function(a){s||(s=!0,!0!==a||x?"string"==typeof a?(L.SetNamedStatusBarText("message",t(r(L.Translate('Starting "{0}" failed.  {1}'),e.fullPath,a)),L.settings.messagetimeout),mt||((mt=L.CreateProgressTracker(wt)).showbyterate=!0),bt(e,"start_failed")):yt(e):(e.status="upload_start",e.progress={started:Date.now(),uploadedbytes:0,byterate:0,percent:0},e.sizebytes="file"===e.type?e.file.size:0,e.currchunkstart=0,e.retries||(e.retries=0),e.retriesleft=e.retries,vt||L.SetNamedStatusBarText("message",t(r(L.Translate('Uploading "{0}"...'),e.fullPath)),5*L.settings.messagetimeout),mt||((mt=L.CreateProgressTracker(wt)).showbyterate=!0),dt||(dt=setInterval(_t,3e4)),gt(),L.UpdateProgressText(),xt(e)))},e,ut])},Et=function(e){e.status="waiting";var t=new FileReader;t.addEventListener("progress",(function(r){t.abort(),e.status="init",e.type="file",St()})),t.addEventListener("load",(function(t){e.status="init",e.type="file",St()})),t.addEventListener("error",(function(t){e.status="invalid_item",F("upload_error",[e,t]),St()})),t.readAsArrayBuffer(e.file)},Tt=function(e,t){if(t.isDirectory){var r=t.createReader(),s={entry:t,reader:r,folder:e,type:"direntry",size:0,fullPath:t.fullPath,busy:!1};e.refs++,ct.push(s)}else if(t.isFile){var a={status:"init",folder:e,type:"file",file:null,fullPath:t.fullPath};e.refs++,t.file((function(e){a.file=e,ft.push(a),St()}),(function(t){a.status="invalid_file",F("upload_error",[a,t]),ve(e),St()}))}},St=function(){if(L.hasEventListener("init_upload")||(vt=!0),vt&&ct.length&&!ct[0].busy&&(ct=[]),!vt&&ft.length<100&&ct.length&&!ct[0].busy){var e=ct[0].folder;ct[0].busy=!0,ct[0].reader.readEntries((function(t){if(ct[0].busy=!1,vt)ct.shift(),gt();else if(t.length)ct[0].size+=t.length,t.forEach((function(t){Tt(e,t)}));else{if(!ct[0].size){var r={status:"init",folder:e,type:"dir",fullPath:ct[0].fullPath};e.refs++,ft.push(r)}ve(e),ct.shift(),gt()}St()}),(function(t){F("upload_error",[ct[0],t]),ve(e),ct.shift(),gt(),St()}))}if(pt.length<L.settings.concurrentuploads&&ft.length){for(var t=0,r=!1,s=0;s<ft.length;s++)if("waiting"===ft[s].status)t++;else if(vt||"invalid_item"===ft[s].status)"invalid_item"===ft[s].status&&console.error("Removed '"+ft[s].fullPath+"' from the upload queue due to an error - it is probably a directory."),ve(ft[s].folder),ft.splice(s,1),s--,gt(),r=!0;else if("init"===ft[s].status)if("file"===ft[s].type||"dir"===ft[s].type){if(pt.length<L.settings.concurrentuploads){var a=ft[s];pt.push(a),ft.splice(s,1),s--,Lt(a),r=!0}}else""===ft[s].type&&t<10&&(Et(ft[s]),t++,r=!0);r&&St()}!mt||pt.length||ft.length||ct.length||x||(L.RemoveProgressTracker(mt,vt||x?"Uploading stopped":"Uploading done"),dt&&(clearInterval(dt),dt=null),L.RefreshFolders(!0),ut=!1,mt=!1,vt=!1,pt=[],ft=[],ct=[])};L.ProcessFilesAndUpload=function(e,t,r){var s;if("currfolder"===e)s=b;else if("path"===e)s=L.GetMappedFolderFromPath(b.GetPath().slice(0,t._fepos+1));else{if("item"!==e)return;var a=b.GetEntries()[b.GetEntryIDMap()[t.dataset.feid]],n=b.GetPath().slice(),i=[a.id,a.name];"attrs"in a&&i.push(a.attrs),n.push(i);var o=me(n);y[o]||(y[o]=new v(n)),s=y[o]}if(r.items&&r.items.length)for(var l=0;l<r.items.length;l++)if("function"==typeof r.items[l].getAsEntry&&(a=r.items[l].getAsEntry()))Tt(s,a);else if("function"==typeof r.items[l].webkitGetAsEntry&&(a=r.items[l].webkitGetAsEntry()))Tt(s,a);else{if(p=r.items[l].getAsFile()){var d={status:"init",folder:s,type:"",file:p};s.refs++,d.fullPath="/"+d.file.name,ft.push(d)}}else if(r.files&&r.files.length)for(l=0;l<r.files.length;l++){var p;d={status:"init",folder:s,type:"",file:p=r.files[l]};s.refs++,d.fullPath="/"+d.file.name,ft.push(d)}St()};var kt=function(e){if(e.isTrusted){if(!1!==Ve){if(e.preventDefault(),"error"!==Ve.lasttype){var t;Ve.lastnode&&Ve.lastnode.classList.remove("fe_fileexplorer_drag_hover");try{t=JSON.parse(e.dataTransfer.getData("application/file-explorer-folder"))}catch(e){}et(e),t&&Ve.dropallowed?(Ze(e,!0),rt(Ve.issource,Ve.lasttype,Ve.lastnode,e.dataTransfer.dropEffect,t)):e.dataTransfer.files&&e.dataTransfer.files.length&&Ve.dropallowed?(ie(),L.ProcessFilesAndUpload(Ve.lasttype,Ve.lastnode,e.dataTransfer),b.SetBusyRef(-1)):(ie(),b.SetBusyRef(-1))}else ie(),b.SetBusyRef(-1);Ve=!1}Xe=0}};k.innerwrap.addEventListener("dragenter",$e),k.innerwrap.addEventListener("dragover",et),k.innerwrap.addEventListener("dragleave",tt),k.innerwrap.addEventListener("drop",kt);var Ct=function(e){if(e.isTrusted){for(var t=e.target;t&&t!==k.itemsscrollwrap;)t=t.parentNode;if(t&&b&&!b.waiting)if("touchstart"===e.type){var r=k.itemsscrollwrapinner.getBoundingClientRect();Ee={x:e.touches[0].clientX-r.left,y:e.touches[0].clientY-r.top,processed:!1},_e=Ee}else{if(ne(!1),e.target.classList.contains("fe_fileexplorer_item_wrap_inner")||e.target.closest(".fe_fileexplorer_item_wrap_inner")){var s=e.target.closest(".fe_fileexplorer_item_wrap"),a=W,n=s.dataset.feid in j;e.ctrlKey||"INPUT"===e.target.tagName||2==e.button||Se?(Ue=!1,L.SetFocusItem(s.dataset.feid,!0)):((Ue=!b.IsBusy()&&!e.shiftKey&&L.hasEventListener("rename")&&1===W&&s.dataset.feid in j&&e.target.classList.contains("fe_fileexplorer_item_text"))&&(Re=b,ze=s.dataset.feid),L.SetFocusItem(s.dataset.feid,!e.shiftKey),!e.shiftKey&&s.dataset.feid in j||L.SelectItemsFromLastAnchor(!0)),je={origelem:s,origevent:e},window.addEventListener("mouseup",We,!0),2==e.button&&(k.itemsclipboardoverlay.value="   ",k.itemsclipboardoverlaypastewrap.classList.remove("fe_fileexplorer_hidden"),k.itemsclipboardoverlaypastewrap.classList.add("fe_fileexplorer_items_clipboard_contextmenu")),a&&(e.detail>1||Ee&&n&&Te&&e.timeStamp-Te.timeStamp<500)&&L.OpenSelectedItems()}else if(Ee&&!Ee.processed)2==e.detail||e.detail<2&&(!Se||1===W)?L.ClearSelectedItems(!0):3==e.detail&&(L.SelectAllItems(),Se=W>0);else{Le=e,k.itemsscrollwrap.focus(),k.itemswrap.classList.add("fe_fileexplorer_items_selecting"),2==e.button&&(k.itemsclipboardoverlay.value="   ",k.itemsclipboardoverlaypastewrap.classList.remove("fe_fileexplorer_hidden"),k.itemsclipboardoverlaypastewrap.classList.add("fe_fileexplorer_items_clipboard_contextmenu"));r=k.itemsscrollwrapinner.getBoundingClientRect();_e={x:e.clientX-r.left,y:e.clientY-r.top},e.ctrlKey||e.shiftKey||L.ClearSelectedItems(!0),be=e.ctrlKey,b.SetBusyRef(1),ge={left:_e.x,top:_e.y,right:_e.x,bottom:_e.y},ke(ge),window.addEventListener("mousemove",De,!0),window.addEventListener("mouseup",Ke,!0),window.addEventListener("blur",Ke,!0),k.itemsscrollwrap.addEventListener("wheel",Fe)}Te=e,Ee&&(Ee.processed?Ee=null:Ee.processed=!0)}}};k.itemsscrollwrapinner.addEventListener("mousedown",Ct),k.itemsscrollwrapinner.addEventListener("touchstart",Ct);var It=function(e){e.isTrusted&&"INPUT"===e.target.tagName&&(e.target.checked=e.target.parentNode.parentNode.classList.contains("fe_fileexplorer_item_selected"))};k.itemsscrollwrapinner.addEventListener("click",It);var Dt=function(e){if(e.isTrusted){if(e.preventDefault(),J&&J.Cancel(),"mousedown"===e.type){var r=k.navtool_history.classList.contains("fe_fileexplorer_block_popup");if(r&&k.navtool_history.classList.remove("fe_fileexplorer_block_popup"),L.HasFocus()){if(document.activeElement===k.navtool_history&&(L.Focus(!0,!0),r))return}else L.Focus(!0,!0)}var s={items:[],onposition:function(e){e.style.left="1px",e.style.top=k.toolbar.offsetTop+k.toolbar.offsetHeight+1+"px"},onselected:function(e,t,r,s){J=null,L.Focus(!0),this.Destroy();var a=y[f[u=e].folderkeys[f[u].folderkeys.length-1]].GetPath();L.SetPath(a)},oncancel:function(e,t){J=null,e&&e.focus(),"mouse"===t&&e===k.navtool_history&&k.navtool_history.classList.add("fe_fileexplorer_block_popup"),this.Destroy()}},a=u-4,n=u+4;a<0&&(n+=-a,a=0),n>f.length-1&&((a-=n-(f.length-1))<0&&(a=0),n=f.length-1);for(var i=a;i<=n;i++){var o=y[f[i].folderkeys[f[i].folderkeys.length-1]].GetPath(),l={id:i,name:t(o[o.length-1][1])};l.icon=i<u?"fe_fileexplorer_popup_item_icon_back":i>u?"fe_fileexplorer_popup_item_icon_forward":"fe_fileexplorer_popup_item_icon_check",s.items.unshift(l)}J=new h(k.mainwrap,s)}};k.navtool_history.addEventListener("mousedown",Dt);var Ft=function(e){e.isTrusted&&(13!=e.keyCode&&32!=e.keyCode||Dt(e))};k.navtool_history.addEventListener("keydown",Ft);var Pt=function(){return k.pathsegmentswrap._fepos},Bt=function(e){var r=e.lastChild.offsetLeft-k.pathsegmentsscrollwrap.scrollLeft+k.pathsegmentsscrollwrap.offsetLeft-18,s=b.GetPath();s=s.slice(0,Pt()+1),e.classList.add("fe_fileexplorer_path_segment_wrap_focus"),e.classList.add("fe_fileexplorer_path_segment_wrap_down"),J&&J.Cancel();var a={items:[],resizewatchers:[{elem:document.body,attr:"offsetWidth",val:-1}],onposition:function(e){var t=r+e.offsetWidth<document.body.offsetWidth?r:document.body.offsetWidth-e.offsetWidth-1;e.style.left=t+"px",e.style.top=k.toolbar.offsetTop+k.toolbar.offsetHeight+"px"},onselected:function(e,t,r,a){J=null,L.Focus(!0),this.Destroy();var n=[t.info.id,t.name];"attrs"in t.info&&n.push(t.info.attrs),s.push(n),L.SetPath(s)},oncancel:function(t,r){J=null,e.classList.remove("fe_fileexplorer_path_segment_wrap_focus"),e.classList.remove("fe_fileexplorer_path_segment_wrap_down"),t&&t.focus(),"mouse"===r&&t.classList.contains("fe_fileexplorer_path_opts")&&e.classList.add("fe_fileexplorer_block_popup"),this.Destroy()},onleft:function(t){var r=Pt();r&&(J=null,e.classList.remove("fe_fileexplorer_path_segment_wrap_focus"),e.classList.remove("fe_fileexplorer_path_segment_wrap_down"),this.PreventCancel(),k.pathsegmentswrap.children[r-1].focus(),this.Destroy(),Bt(k.pathsegmentswrap.children[r-1]))},onright:function(t){var r=Pt();r<k.pathsegmentswrap.children.length-1&&(J=null,e.classList.remove("fe_fileexplorer_path_segment_wrap_focus"),e.classList.remove("fe_fileexplorer_path_segment_wrap_down"),this.PreventCancel(),k.pathsegmentswrap.children[r+1].focus(),this.Destroy(),Bt(k.pathsegmentswrap.children[r+1]))}},n=L.GetMappedFolderFromPath(s);if(n){n=n.GetEntries();for(var i=0;i<n.length;i++)if("folder"===n[i].type){var o={id:a.items.length,name:t(n[i].name),icon:"fe_fileexplorer_popup_item_icon_folder",info:n[i]};a.items.push(o)}J=new h(k.mainwrap,a)}},Nt=function(e){if(e.isTrusted){e.preventDefault();for(var t=k.pathsegmentswrap.children[k.pathsegmentswrap._fepos],r=e.target;r&&r!==k.pathsegmentsscrollwrap;){if(r.parentNode===k.pathsegmentswrap){r.focus();break}r=r.parentNode}if(r&&r===k.pathsegmentsscrollwrap&&t&&t.focus(),r&&e.target.classList.contains("fe_fileexplorer_path_opts"))r.classList.contains("fe_fileexplorer_block_popup")?r.classList.remove("fe_fileexplorer_block_popup"):Bt(r)}};k.pathsegmentsscrollwrap.addEventListener("mousedown",Nt);var Gt=function(e){var t=e.target;t.parentNode===k.pathsegmentswrap&&(k.pathsegmentswrap._fepos!==t._fepos&&(t.tabIndex=0,k.pathsegmentswrap.children[k.pathsegmentswrap._fepos].tabIndex=-1,k.pathsegmentswrap._fepos=t._fepos),t.offsetLeft-1<k.pathsegmentsscrollwrap.scrollLeft?k.pathsegmentsscrollwrap.scrollLeft=t.offsetLeft-1:t.offsetLeft+t.offsetWidth+1>k.pathsegmentsscrollwrap.scrollLeft+k.pathsegmentsscrollwrap.clientWidth&&(k.pathsegmentsscrollwrap.scrollLeft=t.offsetLeft+t.offsetWidth+1-k.pathsegmentsscrollwrap.clientWidth))};k.pathsegmentsscrollwrap.addEventListener("focus",Gt,!0);var At=function(e){if(e.isTrusted&&e.target.classList.contains("fe_fileexplorer_path_name")){var t=b.GetPath();L.SetPath(t.slice(0,Pt()+1)),L.Focus(!0)}};k.pathsegmentsscrollwrap.addEventListener("click",At);var Mt=function(e){if(e.isTrusted)if(37==e.keyCode)e.preventDefault(),(t=Pt())&&k.pathsegmentswrap.children[t-1].focus();else if(39==e.keyCode){var t;(t=Pt())<k.pathsegmentswrap.children.length-1&&(e.preventDefault(),k.pathsegmentswrap.children[t+1].focus())}else if(13==e.keyCode){e.preventDefault();var r=b.GetPath();L.SetPath(r.slice(0,Pt()+1)),L.Focus(!0)}else if(40==e.keyCode){e.preventDefault();var s=k.pathsegmentswrap.children[Pt()];s.focus(),Bt(s)}};k.pathsegmentsscrollwrap.addEventListener("keydown",Mt);var Rt=function(e){if(e.isTrusted&&!k.itemsclipboardoverlaypastewrap.classList.contains("fe_fileexplorer_items_show_clipboard_overlay_paste")){if(e.preventDefault(),W){var r=[];for(var s in j)j.hasOwnProperty(s)&&r.push(s);var a="copy"===e.type?"copy":"move";if(e.clipboardData.dropEffect=a,e.clipboardData.setData("application/file-explorer-clipboard",JSON.stringify({type:a,source:E,group:S,path:b.GetPath(),ids:r})),e.clipboardData.setData("text/plain",JSON.stringify({"application/file-explorer-clipboard":{type:a,source:E,group:S,path:b.GetPath(),ids:r}})),"copy"===e.type&&L.hasEventListener("get_download_url")){var n=b.GetEntries()[b.GetEntryIDMap()[r[0]]],i={};F("get_download_url",[i,b,r,n]),i&&i.name&&i.url&&e.clipboardData.setData("DownloadURL","application/octet-stream:"+i.name+":"+i.url)}L.SetNamedStatusBarText("message",t(L.Translate(("copy"===e.type?"Copy":"Cut")+" to clipboard completed")),L.settings.messagetimeout)}Be(e)}},zt=function(e){if(e.isTrusted){var s;e.preventDefault();try{s=JSON.parse(e.clipboardData.getData("application/file-explorer-clipboard"))}catch(p){try{var a=JSON.parse(e.clipboardData.getData("text/plain"));a["application/file-explorer-clipboard"]&&(s=a["application/file-explorer-clipboard"])}catch(p){}}if(s&&s.group===S&&Array.isArray(s.path)&&Array.isArray(s.ids)&&s.ids.length&&("copy"===s.type&&L.hasEventListener("copy")||"move"===s.type&&L.hasEventListener("move"))){var n="currfolder",i=null;we&&!1!==Q&&Q.classList.contains("fe_fileexplorer_item_folder")&&(n="item",i=Q);var o="copy"===s.type?"Copying":"Moving";if(o+=1===s.ids.length?" 1 item":" {0} items","currfolder"===n){var l=b.GetPath();L.SetNamedStatusBarText("selected",t(r(L.Translate(o+' to "{1}"...'),s.ids.length,l[l.length-1][1])))}else{var d=b.GetEntries()[b.GetEntryIDMap()[i.dataset.feid]];L.SetNamedStatusBarText("selected",t(r(L.Translate(o+' to "{1}"...'),s.ids.length,d.name)))}b.SetBusyRef(1),rt(s.source===E,n,i,s.type,s)}else!s&&e.clipboardData.files&&e.clipboardData.files.length?L.ProcessFilesAndUpload("currfolder",null,e.clipboardData):s&&s.group!==S?L.SetNamedStatusBarText("message",t(L.Translate("Paste operation failed due to mismatched group name")),L.settings.messagetimeout):L.SetNamedStatusBarText("message",t(L.Translate("Paste operation failed")),L.settings.messagetimeout);Be(e)}};k.itemsclipboardoverlay.addEventListener("cut",Rt),k.itemsclipboardoverlay.addEventListener("copy",Rt),k.itemsclipboardoverlay.addEventListener("paste",zt);var Ot=0,Kt="",Ut=function(e){if(e.isTrusted&&!e.altKey){var t=!1;if(37==e.keyCode)e.preventDefault(),ne(!1),!1!==Q?Q.previousSibling&&(L.SetFocusItem(Q.previousSibling.dataset.feid,!e.ctrlKey&&!e.shiftKey),t=!0):$.size&&(L.SetFocusItem(k.itemswrap.firstChild.dataset.feid,!e.ctrlKey&&!e.shiftKey),t=!0);else if(39==e.keyCode)e.preventDefault(),ne(!1),!1!==Q?Q.nextSibling&&(L.SetFocusItem(Q.nextSibling.dataset.feid,!e.ctrlKey&&!e.shiftKey),t=!0):$.size&&(L.SetFocusItem(k.itemswrap.firstChild.dataset.feid,!e.ctrlKey&&!e.shiftKey),t=!0);else if(38==e.keyCode)if(e.preventDefault(),ne(!1),!1!==Q){if(Q.offsetTop!==$.rows[0].top){for(var r=$.cols.length,s=Q;s.previousSibling&&r;)s=s.previousSibling,r--;s!==Q&&(L.SetFocusItem(s.dataset.feid,!e.ctrlKey&&!e.shiftKey),t=!0)}}else $.size&&(L.SetFocusItem(k.itemswrap.firstChild.dataset.feid,!e.ctrlKey&&!e.shiftKey),t=!0);else if(40==e.keyCode)if(e.preventDefault(),ne(!1),!1!==Q){if(Q.offsetTop!==$.rows[$.rows.length-1].top){for(r=$.cols.length,s=Q;s.nextSibling&&r;)s=s.nextSibling,r--;s!==Q&&(L.SetFocusItem(s.dataset.feid,!e.ctrlKey&&!e.shiftKey),t=!0)}}else $.size&&(L.SetFocusItem(k.itemswrap.firstChild.dataset.feid,!e.ctrlKey&&!e.shiftKey),t=!0);else if(36==e.keyCode)ne(!1),$.size&&(L.SetFocusItem(k.itemswrap.firstChild.dataset.feid,!e.ctrlKey&&!e.shiftKey),t=!0);else if(35==e.keyCode)ne(!1),$.size&&(L.SetFocusItem(k.itemswrap.lastChild.dataset.feid,!e.ctrlKey&&!e.shiftKey),t=!0);else if(32==e.keyCode){e.preventDefault(),ne(!1);var a=Date.now()-1e3;Ot>a?(e.key=" ",qt(e)):(!1===Q&&$.size&&(L.SetFocusItem(k.itemswrap.firstChild.dataset.feid,!e.ctrlKey&&!e.shiftKey),t=!0),!1!==Q&&(e.ctrlKey&&(L.SetFocusItem(Q.dataset.feid,!0),L.ToggleItemSelection(Q,!1,!0)),t=!0))}else 13==e.keyCode?(e.preventDefault(),L.OpenSelectedItems()):46==e.keyCode?(e.preventDefault(),L.DeleteSelectedItems(!e.shiftKey)):!e.ctrlKey&&!e.metaKey||88!=e.keyCode&&67!=e.keyCode?(e.ctrlKey||e.metaKey)&&86==e.keyCode?(k.itemsclipboardoverlay.value="",k.itemsclipboardoverlaypastewrap.classList.remove("fe_fileexplorer_hidden"),k.itemsclipboardoverlay.focus(),k.itemsclipboardoverlay.addEventListener("keyup",Pe)):93==e.keyCode&&(k.itemsclipboardoverlay.value="   ",k.itemsclipboardoverlaypastewrap.classList.remove("fe_fileexplorer_hidden"),k.itemsclipboardoverlay.classList.add("fe_fileexplorer_items_clipboard_contextmenu"),Ge()):W&&(k.itemsclipboardoverlay.value="",k.itemsclipboardoverlaypastewrap.classList.remove("fe_fileexplorer_hidden"),k.itemsclipboardoverlay.focus(),k.itemsclipboardoverlay.addEventListener("keyup",Pe));t&&(L.ScrollToFocusedItem(),!1!==Q&&(e.ctrlKey||L.SelectItemsFromLastAnchor(!1,!0),q(),ie()))}};k.itemsscrollwrap.addEventListener("keydown",Ut);var Ht="",qt=function(e){if(k.itemswrap.children.length){var t=Date.now();Ot>t-1e3?Kt+=e.key:Kt=e.key,Ot=t;for(var r=!1,s=b.GetEntries(),a=b.GetEntryIDMap(),n=!1!==Q&&Q.nextSibling?Q.nextSibling:k.itemswrap.firstChild,i=a[n.dataset.feid];n;){if(0===Kt.localeCompare(s[i].name.substring(0,Kt.length),undefined,{sensitivity:"base"})){r=!0;break}n=n.nextSibling,i++}if(!r&&!1!==Q)for(n=k.itemswrap.firstChild,i=0;n&&n!==Q;){if(0===Kt.localeCompare(s[i].name.substring(0,Kt.length),undefined,{sensitivity:"base"})){r=!0;break}n=n.nextSibling,i++}r||2!=Kt.length||Ht!==e.key||(Kt="",qt(e)),r&&(L.SetFocusItem(n.dataset.feid,!0),L.ScrollToFocusedItem(),L.SelectItemsFromLastAnchor()),Ht=e.key}};k.itemsscrollwrap.addEventListener("keypress",qt);var jt=function(e){e.isTrusted&&(e.ctrlKey&&65==e.keyCode?(e.preventDefault(),L.Focus(!0),L.SelectAllItems()):e.altKey&&37==e.keyCode||8==e.keyCode?(e.preventDefault(),L.HistoryBack()):e.altKey&&39==e.keyCode?(e.preventDefault(),L.HistoryForward()):e.altKey&&38==e.keyCode?(e.preventDefault(),L.NavigateUp()):113==e.keyCode&&L.hasEventListener("rename")&&(e.preventDefault(),L.RenameSelectedItem()),F("keydown",e))};k.innerwrap.addEventListener("keydown",jt),L.HasFocus=function(e){var t=document.activeElement;if(e){for(;t&&t!==k.itemsscrollwrap;)t=t.parentNode;return t===k.itemsscrollwrap}for(;t&&t!==k.mainwrap;)t=t.parentNode;return t===k.mainwrap},L.Focus=function(e,t){var r=document.activeElement;if(t);else if(e){for(;r&&r!==k.itemsscrollwrap;)r=r.parentNode;r!==k.itemsscrollwrap&&(t=!0)}else{for(;r&&r!==k.mainwrap;)r=r.parentNode;r!==k.mainwrap&&(t=!0)}t&&(!1!==Q?Q.firstChild.focus():k.itemsscrollwrap.focus())},L.HasItemFocus=function(){var e=document.activeElement;return!1!==Q&&e&&e.parentNode===Q},L.GetFocusedItem=function(){return Q},L.GetFocusedItemID=function(){return!1!==Q&&Q.dataset.feid},L.IsMappedFolder=function(e){if(b===e)return!0;for(var t in y)if(y.hasOwnProperty(t)&&e===y[t])return!0;return!1},L.GetCurrentFolder=function(){return b},L.GetSelectedItemIDs=function(){var e=[];for(var t in j)j.hasOwnProperty(t)&&e.push(t);return e},L.GetSelectedFolderEntries=function(){for(var e=b.GetEntries(),t=[],r=0;r<e.length;r++)e[r].id in j&&t.push(e[r]);return t},L.IsSelectedItem=function(e){return e in j},L.SetSelectedItems=function(e,t,r){if(b&&b.IsBusy())b.AddBusyQueueCallback(L.SetSelectedItems,[e]);else if(b&&!b.waiting&&Array.isArray(e)){t||L.ClearSelectedItems(!1,!0);for(var s=b.GetEntryIDMap(),a=0;a<e.length;a++)if(e[a]in s&&!(e[a]in j)){var n=s[e[a]],i=k.itemswrap.children[n];i.classList.add("fe_fileexplorer_item_selected"),i.firstChild.firstChild.checked=!0,j[i.dataset.feid]=n,W++}r||(q(),ie())}},L.GetNumSelectedItems=function(){return W},L.NavigateUp=function(e){if(e&&e.preventDefault(),b){var t=b.GetPath();t.length>1&&L.SetPath(t.slice(0,-1))}};var Wt=function(e){e.isTrusted&&(L.NavigateUp(e),L.Focus(!0))};k.navtool_up.addEventListener("mouseup",Wt);var Qt=function(e){e.isTrusted&&(13!=e.keyCode&&32!=e.keyCode||(L.NavigateUp(e),0==k.navtool_up.tabIndex?k.navtool_up.focus():k.navtool_history.focus()))};k.navtool_up.addEventListener("keydown",Qt),L.HistoryBack=function(e){if(e&&e.preventDefault(),u>0){u--;var t=y[f[u].folderkeys[f[u].folderkeys.length-1]].GetPath();L.SetPath(t)}};var Yt=function(e){e.isTrusted&&(L.HistoryBack(e),L.Focus(!0))};k.navtool_back.addEventListener("mouseup",Yt);var Jt=function(e){e.isTrusted&&(13!=e.keyCode&&32!=e.keyCode||(L.HistoryBack(e),u>0?k.navtool_back.focus():u<f.length-1?k.navtool_forward.focus():k.navtool_history.focus()))};k.navtool_back.addEventListener("keydown",Jt),L.HistoryForward=function(e){if(e&&e.preventDefault(),u>-1&&u<f.length-1){u++;var t=y[f[u].folderkeys[f[u].folderkeys.length-1]].GetPath();L.SetPath(t)}};var Xt=function(e){e.isTrusted&&(L.HistoryForward(e),L.Focus(!0))};k.navtool_forward.addEventListener("mouseup",Xt);var Vt=function(e){e.isTrusted&&(13!=e.keyCode&&32!=e.keyCode||(L.HistoryForward(e),u<f.length-1?k.navtool_forward.focus():u>0?k.navtool_back.focus():k.navtool_history.focus()))};k.navtool_forward.addEventListener("keydown",Vt),L.GetElements=function(){return k},L.EscapeHTML=t,L.FormatStr=r,L.GetDisplayFilesize=s,L.CreateNode=a,L.DebounceAttributes=n,L.PrepareXHR=c,L.GetScrollLineHeight=function(){return i};var Zt,$t=null,er=0;L.StartOperationIndicator=function(){er++,k.innerwrap.classList.add("fe_fileexplorer_operation_in_progress"),$t&&clearTimeout($t),$t=setTimeout((function(){k.innerwrap.classList.remove("fe_fileexplorer_operation_in_progress"),$t=null,er=0}),15e3)},L.StopOperationIndicator=function(){--er<=0&&(k.innerwrap.classList.remove("fe_fileexplorer_operation_in_progress"),$t&&(clearTimeout($t),$t=null),er=0)},L.RenameSelectedItem=function(){if(b&&b.IsBusy())b.AddBusyQueueCallback(L.RenameSelectedItem,[]);else if(b&&!b.waiting&&(!("canmodify"in b.GetAttributes())||b.GetAttributes().canmodify)&&L.hasEventListener("rename")&&1===W){var e=-1,s=null;for(var a in j)j.hasOwnProperty(a)&&(e=j[a],s=k.itemswrap.children[e]);if(s){L.SetFocusItem(s.dataset.feid,!0),s.firstChild.lastChild.classList.add("fe_fileexplorer_invisible");var n=b,i=b.GetEntries()[e],o=i.name.lastIndexOf(".");b.SetBusyRef(1);var l={initvalue:i.name,initselstart:0,initselend:"file"===i.type&&o>0?o:-1,resizewatchers:[{elem:s,attr:"offsetLeft",val:-1},{elem:k.itemsscrollwrap,attr:"offsetHeight",val:-1}],onposition:function(e){e.style.left=s.offsetLeft+"px",e.style.width=s.offsetWidth+"px";var t=Math.min(k.itemsscrollwrap.offsetHeight-1,e.scrollHeight+2);e.style.top=(s.offsetTop+s.firstChild.lastChild.offsetTop-2+t<=k.itemsscrollwrap.scrollTop+k.itemsscrollwrap.offsetHeight-2?s.offsetTop+s.firstChild.lastChild.offsetTop-2:k.itemsscrollwrap.scrollTop+k.itemsscrollwrap.offsetHeight-2-t)+"px",e.style.height=t+"px"},ondone:function(e,a,o){var l=this,d=!1;L.StartOperationIndicator(),L.SetNamedStatusBarText("message",t(r(L.Translate('Renaming "{0}" to "{1}"...'),i.name,e)),L.settings.messagetimeout),F("rename",[function(o){d||x||(d=!0,L.StopOperationIndicator(),"object"==typeof o?(s.firstChild.lastChild.classList.remove("fe_fileexplorer_invisible"),L.SetNamedStatusBarText("message",""),a&&Q&&a===Q.firstChild&&(a.focus(),L.ScrollToFocusedItem()),Zt=null,b.SetBusyRef(-1),L.IsMappedFolder(n)&&(n.SetEntry(o),i.id!==o.id&&(b===n&&(!1!==Q&&i.id===Q.dataset.feid&&(L.SetFocusItem(o.id,!0),L.ScrollToFocusedItem()),i.id in j&&L.SetSelectedItems([o.id],!0)),n.RemoveEntry(i.id)),l.Destroy())):(l.ResetAllowCancelDone(),L.SetNamedStatusBarText("message",t(r(L.Translate('Renaming "{0}" to "{1}" failed.'+("string"==typeof o?"  {2}":"")),i.name,e,o)),L.settings.messagetimeout)))},b,Object.assign({},i),e])},oncancel:function(e,t){s.firstChild.lastChild.classList.remove("fe_fileexplorer_invisible"),e&&Q&&e===Q.firstChild&&(e.focus(),L.ScrollToFocusedItem()),Zt=null,this.Destroy(),b.SetBusyRef(-1)}};Zt=new w(k.itemsscrollwrapinner,l)}}},L.DeleteSelectedItems=function(e){if(b&&b.IsBusy())b.AddBusyQueueCallback(L.DeleteSelectedItems,[e]);else if(b&&!b.waiting&&(!("canmodify"in b.GetAttributes())||b.GetAttributes().canmodify)&&L.hasEventListener("delete")&&W){b.SetBusyRef(1);var s=b,a=Object.assign({},j),n=W,i=!1;L.StartOperationIndicator(),1===W?L.SetNamedStatusBarText("message",t(L.Translate("Deleting 1 item...")),L.settings.messagetimeout):L.SetNamedStatusBarText("message",t(r(L.Translate("Deleting {0} items..."),W)),L.settings.messagetimeout),F("delete",[function(e){if(!i&&!x&&(i=!0,L.StopOperationIndicator(),L.IsMappedFolder(s)))if(!0===e){if(L.SetNamedStatusBarText("message",""),b.SetBusyRef(-1),b===s){if(1===n)for(var o in a)a.hasOwnProperty(o)&&(!1!==Q&&Q.dataset.feid===o&&(Q.nextSibling?L.SetFocusItem(Q.nextSibling.dataset.feid,!0):Q.previousSibling&&L.SetFocusItem(Q.previousSibling.dataset.feid,!0),L.ScrollToFocusedItem()),b.RemoveEntry(o));else{var l=b.GetEntries(),d=[];for(o=0;o<l.length;o++)l[o].id in a||d.push(l[o]);if(!1!==Q&&Q.dataset.feid in a){for(var p=Q.nextSibling;p&&p.dataset.feid in a;)p=p.nextSibling;if(!p)for(p=Q.previousSibling;p&&p.dataset.feid in a;)p=p.previousSibling;p&&(L.SetFocusItem(p.dataset.feid,!0),L.ScrollToFocusedItem())}b.SetEntries(d)}L.RefreshFolders()}}else L.SetNamedStatusBarText("message",t(r(L.Translate("Deleting items failed."+("string"==typeof e?"  {0}":"")),e)),L.settings.messagetimeout),b.SetBusyRef(-1),b===s&&L.RefreshFolders(!0)},b,L.GetSelectedItemIDs(),L.GetSelectedFolderEntries(),e])}},L.IsDestroyed=function(){return x},L.Destroy=function(){for(var e in x=!0,y)y.hasOwnProperty(e)&&(y[e].ClearBusyQueueCallbacks(),ve(y[e]));for(var e in F("destroy"),rr=[],p={},f=[],u=-1,j={},Q=!1,J&&J.Cancel(),Zt&&Zt.Cancel(),k.statusbartextsegmentmap)k.statusbartextsegmentmap.hasOwnProperty(e)&&k.statusbartextsegmentmap[e].timeout&&(clearTimeout(k.statusbartextsegmentmap[e].timeout),k.statusbartextsegmentmap[e].timeout=null);for(var e in window.removeEventListener("resize",D.Start,!0),D.Destroy(),D=null,B&&(o-=B,B=0,window.removeEventListener("popstate",P,!0),window.history.state&&window.history.state._fileexplorer&&window.history.back()),k.mainwrap.removeEventListener("mouseenter",N),k.mainwrap.removeEventListener("mouseleave",G),k.mainwrap.removeEventListener("mousedown",A),k.mainwrap.removeEventListener("mouseup",A),k.mainwrap.removeEventListener("click",A),window.removeEventListener("mousedown",R,!0),window.removeEventListener("blur",z,!0),window.removeEventListener("focus",O,!0),k.bodytoolbar.removeEventListener("keydown",K),k.bodytoolsscrollwrap.removeEventListener("focus",U,!0),ee)ee.hasOwnProperty(e)&&m.RemoveFromQueue(e);for(ee={},te={},k.itemsscrollwrap.removeEventListener("scroll",ae.Start),window.removeEventListener("resize",ae.Start,!0),ae.Destroy(),ae=null,$=null,k.pathsegmentsscrollwrap.removeEventListener("wheel",ce),k.navtools.removeEventListener("keydown",ue),b&&(b.removeEventListener("set_entries",pe),b.removeEventListener("remove_entry",fe)),_e=null,ge=null,ye=null,Le=null,xe&&(clearInterval(xe),xe=null),Ee=null,Te=null,Be(),qe(),Re=null,ze=null,je=null,Ve=!1,k.itemswrap.removeEventListener("dragstart",Qe),k.itemswrap.removeEventListener("dragend",Ye),k.innerwrap.removeEventListener("dragenter",$e),k.innerwrap.removeEventListener("dragover",et),k.innerwrap.removeEventListener("dragleave",tt),k.innerwrap.removeEventListener("drop",kt),st.length&&nt(),st=[],Je&&(clearInterval(Je),Je=null),lt(),k.statusbaractionprogresscancelwrap.removeEventListener("click",nt),k.statusbaractionprogresscancelwrap.removeEventListener("keydown",it),dt&&(clearInterval(dt),dt=null),window.removeEventListener("mouseup",We,!0),window.removeEventListener("mousemove",De,!0),window.removeEventListener("mouseup",Ke,!0),window.removeEventListener("blur",Ke,!0),k.itemsscrollwrap.removeEventListener("wheel",Fe),k.itemsscrollwrapinner.removeEventListener("mousedown",Ct),k.itemsscrollwrapinner.removeEventListener("touchstart",Ct),k.itemsscrollwrapinner.removeEventListener("click",It),k.navtool_history.removeEventListener("mousedown",Dt),k.navtool_history.removeEventListener("keydown",Ft),k.pathsegmentsscrollwrap.removeEventListener("mousedown",Nt),k.pathsegmentsscrollwrap.removeEventListener("focus",Gt,!0),k.pathsegmentsscrollwrap.removeEventListener("click",At),k.pathsegmentsscrollwrap.removeEventListener("keydown",Mt),k.itemsscrollwrap.removeEventListener("cut",Rt),k.itemsscrollwrap.removeEventListener("copy",Rt),k.itemsscrollwrap.removeEventListener("paste",zt),k.itemsclipboardoverlay.removeEventListener("cut",Rt),k.itemsclipboardoverlay.removeEventListener("copy",Rt),k.itemsclipboardoverlay.removeEventListener("paste",zt),Kt="",Ht="",k.itemsscrollwrap.removeEventListener("keydown",Ut),k.itemsscrollwrap.removeEventListener("keypress",qt),k.innerwrap.removeEventListener("keydown",jt),k.navtool_up.removeEventListener("mouseup",Wt),k.navtool_up.removeEventListener("keydown",Qt),k.navtool_back.removeEventListener("mouseup",Yt),k.navtool_back.removeEventListener("keydown",Jt),k.navtool_forward.removeEventListener("mouseup",Xt),k.navtool_forward.removeEventListener("keydown",Vt),$t&&(clearTimeout($t),$t=null);k.pathsegmentswrap.firstChild;)k.pathsegmentswrap.removeChild(k.pathsegmentswrap.lastChild);for(;k.itemswrap.firstChild;)k.itemswrap.removeChild(k.itemswrap.lastChild);for(var t in k)if(Array.isArray(k[t]))for(e=0;e<k[t].length;e++)k[t][e].parentNode&&k[t][e].parentNode.removeChild(k[t][e]);else k[t].parentNode&&k[t].parentNode.removeChild(k[t]);k=null,L.settings=Object.assign({},T),b=!1,L=null,l=null,d=null};var tr,rr=[],sr=0,ar=function(e){e.isTrusted&&(e.target.classList.contains("fe_fileexplorer_disabled")||k.bodytools.forEach((function(t){t.tabIndex=t!==e.target||t.classList.contains("fe_fileexplorer_disabled")?-1:0})))};L.AddToolbarButton=function(e,t){var r=a("button",[e,"fe_fileexplorer_disabled"],{title:t,tabIndex:-1});return r.addEventListener("click",ar),sr&&!tr&&k.bodytoolbar.appendChild(a("div",["fe_fileexplorer_folder_tool_separator"])),k.bodytoolbar.appendChild(r),k.bodytools.push(r),sr++,tr++,r};for(var nr=0;nr<g.length;nr++){tr=0;for(var ir=0;ir<g[nr].length;ir++)rr.push(new g[nr][ir](L))}sr&&k.bodytoolsscrollwrap.classList.remove("fe_fileexplorer_hidden"),L.SetPath(L.settings.initpath)},window.FileExplorer.ImageLoader=u,window.FileExplorer.PopupMenu=h,window.FileExplorer.TextareaOverlay=w,window.FileExplorer.RegisterTool=function(e,t){for(;e>=g.length;)g.push([]);g[e].push(t)};var y=function(e){if(!(this instanceof y))return new y(e);if(e.settings.onnewfolder||e.settings.tools.new_folder){var s=!1,a=e.AddToolbarButton("fe_fileexplorer_folder_tool_new_folder",e.Translate("New Folder (Ctrl + Ins)"));e.settings.onnewfolder&&e.addToolEventListener("new_folder",e.settings.onnewfolder);var n=function(){if(s){var a=e.GetCurrentFolder(),n=!1;e.StartOperationIndicator(),e.SetNamedStatusBarText("message",t(e.Translate("Creating a new folder...")),e.settings.messagetimeout),e.DispatchToolEvent("new_folder",[function(s){n||e.IsDestroyed()||(n=!0,e.StopOperationIndicator(),"object"==typeof s?e.IsMappedFolder(a)&&(e.SetNamedStatusBarText("message",""),a.SetEntry(s),e.GetCurrentFolder()===a&&(e.SetFocusItem(s.id,!0),e.ScrollToFocusedItem(),e.SetSelectedItems([s.id]),e.RenameSelectedItem())):e.SetNamedStatusBarText("message",t(r(e.Translate("Creating a new folder failed."+("string"==typeof s?"  {0}":"")),s)),e.settings.messagetimeout))},a])}},i=function(e){e.isTrusted&&n()};a.addEventListener("click",i);e.addEventListener("keydown",(function(e){!e.ctrlKey||e.shiftKey||e.altKey||45!=e.keyCode||(e.preventDefault(),n())}));e.addEventListener("update_tool",(function(t,r){s!==(s=!t.waiting&&(!("canmodify"in r)||r.canmodify))&&(s?a.classList.remove("fe_fileexplorer_disabled"):a.classList.add("fe_fileexplorer_disabled"),e.ToolStateUpdated())}));e.addEventListener("destroy",(function(){a.removeEventListener("click",i)}))}};window.FileExplorer.RegisterTool(0,y);var b=function(e){if(!(this instanceof b))return new b(e);if(e.settings.onnewfile||e.settings.tools.new_file){var s=!1,a=e.AddToolbarButton("fe_fileexplorer_folder_tool_new_file",e.Translate("New File (Ins)"));e.settings.onnewfile&&e.addToolEventListener("new_file",e.settings.onnewfile);var n=function(){if(s){var a=e.GetCurrentFolder(),n=!1;e.StartOperationIndicator(),e.SetNamedStatusBarText("message",t(e.Translate("Creating a new file...")),e.settings.messagetimeout),e.DispatchToolEvent("new_file",[function(s){n||e.IsDestroyed()||(n=!0,e.StopOperationIndicator(),"object"==typeof s?e.IsMappedFolder(a)&&(e.SetNamedStatusBarText("message",""),a.SetEntry(s),e.GetCurrentFolder()===a&&(e.SetFocusItem(s.id,!0),e.ScrollToFocusedItem(),e.SetSelectedItems([s.id]),e.RenameSelectedItem())):e.SetNamedStatusBarText("message",t(r(e.Translate("Creating a new file failed."+("string"==typeof s?"  {0}":"")),s)),e.settings.messagetimeout))},a])}},i=function(e){e.isTrusted&&n()};a.addEventListener("click",i);e.addEventListener("keydown",(function(e){e.ctrlKey||e.shiftKey||e.altKey||45!=e.keyCode||(e.preventDefault(),n())}));e.addEventListener("update_tool",(function(t,r){s!==(s=!t.waiting&&(!("canmodify"in r)||r.canmodify))&&(s?a.classList.remove("fe_fileexplorer_disabled"):a.classList.add("fe_fileexplorer_disabled"),e.ToolStateUpdated())}));e.addEventListener("destroy",(function(){a.removeEventListener("click",i)}))}};window.FileExplorer.RegisterTool(0,b);var x=function(e){if(!(this instanceof x))return new x(e);if(e.hasEventListener("init_upload")||e.settings.tools.upload){var t=!1,r=null,s=e.AddToolbarButton("fe_fileexplorer_folder_tool_upload",e.Translate("Upload (Ctrl + U)")),n=function(){r&&(r.removeEventListener("change",i),r.parentNode.removeChild(r),r=null)},i=function(t){e.ProcessFilesAndUpload("currfolder",null,r),n()},o=function(){t&&(r||(n(),(r=a("input",["fe_fileexplorer_hidden"],{type:"file",multiple:!0})).addEventListener("change",i),e.GetElements().mainwrap.appendChild(r)),r.click())},l=function(e){e.isTrusted&&o()};s.addEventListener("click",l);e.addEventListener("keydown",(function(e){!e.ctrlKey||e.shiftKey||e.altKey||85!=e.keyCode||(e.preventDefault(),o())}));e.addEventListener("update_tool",(function(r,a){t!==(t=!r.waiting&&(!("canmodify"in a)||a.canmodify))&&(t?s.classList.remove("fe_fileexplorer_disabled"):s.classList.add("fe_fileexplorer_disabled"),e.ToolStateUpdated())}));e.addEventListener("destroy",(function(){n(),s.removeEventListener("click",l)}))}};window.FileExplorer.RegisterTool(0,x);var L=function(e){if(!(this instanceof L))return new L(e);if(e.settings.oninitdownload||e.settings.tools.download){var s=!1,n=e.AddToolbarButton("fe_fileexplorer_folder_tool_download",e.Translate("Download"));e.settings.oninitdownload&&e.addToolEventListener("init_download",e.settings.oninitdownload),e.settings.ondownloadstarted&&e.addToolEventListener("download_started",e.settings.ondownloadstarted),e.settings.ondownloaderror&&e.addToolEventListener("download_error",e.settings.ondownloaderror);var i=function(n){if(n.isTrusted&&s){var i=!1;e.StartOperationIndicator(),e.SetNamedStatusBarText("message",t(e.Translate("Initializing download...")),e.settings.messagetimeout),e.DispatchToolEvent("init_download",[function(s){if(!i&&!e.IsDestroyed())if(i=!0,"object"==typeof s){var n=s.method||"POST",o=a("form",["fe_fileexplorer_hidden"],{action:s.url,method:n,enctype:"multipart/form-data"});if(s.params)if(s.params instanceof FormData)for(var l in s.params)"string"==typeof l[1]&&o.appendChild(a("input",[],{type:"hidden",name:l[0],value:l[1]}));else if(Array.isArray(s.params))for(var d=0;d<s.params.length;d++)o.appendChild(a("input",[],{type:"hidden",name:s.params[d].name,value:s.params[d].value}));else for(var d in s.params)s.params.hasOwnProperty(d)&&"string"==typeof s.params[d]&&o.appendChild(a("input",[],{type:"hidden",name:d,value:s.params[d]}));if(!("iframe"in s)||s.iframe){var p=a("iframe",["fe_fileexplorer_download_iframe_wrap"]),f=function(){p&&(document.body.removeChild(p),p=null,e.DispatchToolEvent("download_started",s))},u=function(t){if(e.StopOperationIndicator(),setTimeout(f,5e3),m){var r=m;m=null,r.Destroy()}},m=new c(s);m.addEventListener("progress",u),m.addEventListener("loadend",u),m.addEventListener("timeout",u);p.addEventListener("load",(function(a){if(o)p.contentWindow.document.body.appendChild(o),o.submit(),o=null,m.Send();else if(p){if(e.StopOperationIndicator(),document.body.removeChild(p),p=null,m){var n=m;m=null,n.Destroy()}e.SetNamedStatusBarText("message",t(r(e.Translate("Download failed to start"))),e.settings.messagetimeout),e.DispatchToolEvent("download_error",s)}})),document.body.appendChild(p)}else e.StopOperationIndicator(),o.target="_blank",document.body.appendChild(o),o.submit(),document.body.removeChild(o);e.SetNamedStatusBarText("message",t(r(e.Translate("Starting download..."))),e.settings.messagetimeout)}else e.StopOperationIndicator(),e.SetNamedStatusBarText("message",t(r(e.Translate("Download initialization failed."+("string"==typeof s?"  {0}":"")),s)),e.settings.messagetimeout)},e.GetCurrentFolder(),e.GetSelectedItemIDs(),e.GetSelectedFolderEntries()])}};n.addEventListener("click",i);e.addEventListener("update_tool",(function(t,r){s!==(s=!t.waiting&&e.GetNumSelectedItems()>0)&&(s?n.classList.remove("fe_fileexplorer_disabled"):n.classList.add("fe_fileexplorer_disabled"),e.ToolStateUpdated())}));e.addEventListener("destroy",(function(){n.removeEventListener("click",i)}))}};window.FileExplorer.RegisterTool(0,L);var E=function(e){if(!(this instanceof E))return new E(e);if(e.hasEventListener("copy")||e.settings.tools.copy){var t=!1,r=e.AddToolbarButton("fe_fileexplorer_folder_tool_copy",e.Translate("Copy ("+(navigator.platform.indexOf("Mac")>-1?"⌘":"Ctrl")+" + C)")),s=function(r){if(r.isTrusted&&t){var s=e.GetElements();s.itemsclipboardoverlay.value="",s.itemsclipboardoverlaypastewrap.classList.remove("fe_fileexplorer_hidden"),s.itemsclipboardoverlay.focus(),document.execCommand("copy")}};r.addEventListener("click",s);e.addEventListener("update_tool",(function(s,a){t!==(t=!s.waiting&&e.GetNumSelectedItems()>0)&&(t?r.classList.remove("fe_fileexplorer_disabled"):r.classList.add("fe_fileexplorer_disabled"),e.ToolStateUpdated())}));e.addEventListener("destroy",(function(){r.removeEventListener("click",s)}))}};window.FileExplorer.RegisterTool(1,E);var T=function(e){if(!(this instanceof T))return new T(e);if(e.hasEventListener("copy")||e.hasEventListener("move")||e.settings.tools.paste){var t=!1,r=e.AddToolbarButton("fe_fileexplorer_folder_tool_paste",e.Translate("Paste ("+(navigator.platform.indexOf("Mac")>-1?"⌘":"Ctrl")+" + V)")),s=function(r){r.isTrusted&&t&&e.ShowClipboardPasteBox()},a=function(r){r.isTrusted&&t&&(13!=r.keyCode&&32!=r.keyCode||(e.ShowClipboardPasteBox(),e.GetElements().itemsclipboardoverlay.focus()))};r.addEventListener("mouseup",s),r.addEventListener("keyup",a);e.addEventListener("update_tool",(function(s,a){t!==(t=!s.waiting&&(!("canmodify"in a)||a.canmodify))&&(t?r.classList.remove("fe_fileexplorer_disabled"):r.classList.add("fe_fileexplorer_disabled"),e.ToolStateUpdated())}));e.addEventListener("destroy",(function(){r.removeEventListener("mouseup",s),r.removeEventListener("keyup",a)}))}};window.FileExplorer.RegisterTool(1,T);var S=function(e){if(!(this instanceof S))return new S(e);if(e.hasEventListener("move")||e.settings.tools.cut){var t=!1,r=e.AddToolbarButton("fe_fileexplorer_folder_tool_cut",e.Translate("Cut ("+(navigator.platform.indexOf("Mac")>-1?"⌘":"Ctrl")+" + X)")),s=function(r){if(r.isTrusted&&t){var s=e.GetElements();s.itemsclipboardoverlay.value="",s.itemsclipboardoverlaypastewrap.classList.remove("fe_fileexplorer_hidden"),s.itemsclipboardoverlay.focus(),document.execCommand("cut")}};r.addEventListener("click",s);e.addEventListener("update_tool",(function(s,a){t!==(t=!s.waiting&&(!("canmodify"in a)||a.canmodify)&&e.GetNumSelectedItems()>0)&&(t?r.classList.remove("fe_fileexplorer_disabled"):r.classList.add("fe_fileexplorer_disabled"),e.ToolStateUpdated())}));e.addEventListener("destroy",(function(){r.removeEventListener("click",s)}))}};window.FileExplorer.RegisterTool(1,S);var k=function(e){if(!(this instanceof k))return new k(e);if(e.hasEventListener("delete")||e.settings.tools["delete"]){var t=!1,r=e.AddToolbarButton("fe_fileexplorer_folder_tool_delete",e.Translate("Delete (Del)")),s=function(r){r.isTrusted&&t&&e.DeleteSelectedItems(!r.shiftKey)};r.addEventListener("click",s);e.addEventListener("update_tool",(function(s,a){t!==(t=!s.waiting&&(!("canmodify"in a)||a.canmodify)&&e.GetNumSelectedItems())&&(t?r.classList.remove("fe_fileexplorer_disabled"):r.classList.add("fe_fileexplorer_disabled"),e.ToolStateUpdated())}));e.addEventListener("destroy",(function(){r.removeEventListener("click",s)}))}};window.FileExplorer.RegisterTool(1,k);var C=function(e){if(!(this instanceof C))return new C(e);if(matchMedia("(pointer: coarse)").matches||e.settings.tools.item_checkboxes){var t=e.AddToolbarButton("fe_fileexplorer_folder_tool_item_checkboxes",e.Translate("Item Checkboxes"));t.classList.remove("fe_fileexplorer_disabled");var r=function(t){t.isTrusted&&e.GetElements().innerwrap.classList.toggle("fe_fileexplorer_show_item_checkboxes")};t.addEventListener("click",r);e.addEventListener("destroy",(function(){t.removeEventListener("click",r)}))}};window.FileExplorer.RegisterTool(2,C)}function I(e,t){if(!e.dataTransfer)return!1;for(var r=0;r<e.dataTransfer.types.length;r++)if(e.dataTransfer.types[r].startsWith("application/file-explorer-icon;"))try{var s=JSON.parse(e.dataTransfer.types[r].substring(31));return(!t||t===s.group)&&s}catch(e){}return!1}function D(e){--p<1&&(p=0,d&&(d.parentNode.removeChild(d),d=null),f={})}}();